<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0f172a">
<link rel="manifest" href="/manifest.json">
<title>渊博579 HR V6</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0f172a;--card:#1e293b;--card2:#334155;--border:#475569;--pri:#4f6ef7;--pri2:#6366f1;
--green:#22c55e;--red:#ef4444;--yellow:#eab308;--orange:#f97316;--cyan:#06b6d4;
--text:#e2e8f0;--text2:#94a3b8;--text3:#64748b;--radius:10px;--safe-top:env(safe-area-inset-top,0px);
--safe-bottom:env(safe-area-inset-bottom,0px)}
html,body,#root{height:100%;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;font-size:14px;overflow:hidden}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:var(--border);border-radius:4px}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
.fade{animation:fadeIn .25s ease}
/* Layout */
.app{display:flex;height:100%;padding-top:var(--safe-top)}
.sidebar{width:220px;background:var(--card);border-right:1px solid var(--border);display:flex;flex-direction:column;overflow-y:auto;flex-shrink:0;transition:transform .3s}
.sidebar .logo{padding:16px;text-align:center;font-size:18px;font-weight:700;color:var(--pri);border-bottom:1px solid var(--border)}
.sidebar .logo small{display:block;font-size:11px;color:var(--text2);font-weight:400}
.nav-item{padding:10px 16px;cursor:pointer;display:flex;align-items:center;gap:8px;color:var(--text2);transition:.15s;font-size:13px;border-left:3px solid transparent}
.nav-item:hover{background:rgba(79,110,247,.1);color:var(--text)}
.nav-item.active{background:rgba(79,110,247,.15);color:var(--pri);border-left-color:var(--pri);font-weight:600}
.nav-group{padding:8px 16px 4px;font-size:11px;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-top:4px}
.main{flex:1;display:flex;flex-direction:column;overflow:hidden}
.header{height:52px;background:var(--card);border-bottom:1px solid var(--border);display:flex;align-items:center;padding:0 16px;gap:12px;flex-shrink:0}
.header .menu-btn{display:none;font-size:20px;cursor:pointer;padding:4px}
.header .title{font-size:16px;font-weight:600;flex:1}
.header .user-info{display:flex;align-items:center;gap:8px;font-size:13px}
.header .badge{background:var(--pri);color:#fff;padding:2px 8px;border-radius:10px;font-size:11px}
.content{flex:1;overflow-y:auto;padding:16px;padding-bottom:calc(16px + var(--safe-bottom))}
/* Components */
.card{background:var(--card);border-radius:var(--radius);padding:16px;margin-bottom:12px;border:1px solid var(--border)}
.login-page{display:flex;align-items:center;justify-content:center;min-height:100vh;padding:24px;background:radial-gradient(circle at 20% 20%,rgba(79,110,247,.18),transparent 38%),radial-gradient(circle at 80% 80%,rgba(99,102,241,.16),transparent 40%),var(--bg)}
.login-card{width:min(420px,100%);padding:24px 20px;border-radius:14px;box-shadow:0 12px 42px rgba(2,6,23,.45);text-align:center}
.login-fallback{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;padding:24px;background:radial-gradient(circle at 20% 20%,rgba(79,110,247,.18),transparent 38%),radial-gradient(circle at 80% 80%,rgba(99,102,241,.16),transparent 40%),var(--bg);z-index:5}
.login-fallback .login-card{max-width:420px;width:100%}
.login-fallback .hint{margin-top:10px;font-size:12px;color:var(--text3)}
.stats{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px;margin-bottom:16px}
.stat{background:var(--card);border-radius:var(--radius);padding:14px;border:1px solid var(--border);text-align:center}
.stat .num{font-size:28px;font-weight:700;color:var(--pri)}
.stat .label{font-size:12px;color:var(--text2);margin-top:4px}
.btn{padding:6px 14px;border-radius:6px;border:none;cursor:pointer;font-size:13px;font-weight:500;transition:.15s;display:inline-flex;align-items:center;gap:4px}
.btn-pri{background:var(--pri);color:#fff}.btn-pri:hover{background:var(--pri2)}
.btn-green{background:var(--green);color:#fff}.btn-red{background:var(--red);color:#fff}
.btn-ghost{background:transparent;color:var(--text2);border:1px solid var(--border)}.btn-ghost:hover{color:var(--text);border-color:var(--text2)}
.btn-sm{padding:4px 10px;font-size:12px}
.table-wrap{overflow-x:auto;margin-top:8px}
table{width:100%;border-collapse:collapse;font-size:13px}
th{background:var(--card2);padding:8px 10px;text-align:left;font-weight:600;white-space:nowrap;position:sticky;top:0;z-index:1}
td{padding:7px 10px;border-top:1px solid var(--border);white-space:nowrap}
tr:hover td{background:rgba(79,110,247,.05)}
.badge-s{padding:2px 8px;border-radius:10px;font-size:11px;font-weight:600;display:inline-block}
.bg-green{background:rgba(34,197,94,.15);color:var(--green)}
.bg-red{background:rgba(239,68,68,.15);color:var(--red)}
.bg-yellow{background:rgba(234,179,8,.15);color:var(--yellow)}
.bg-blue{background:rgba(79,110,247,.15);color:var(--pri)}
.bg-cyan{background:rgba(6,182,212,.15);color:var(--cyan)}
.bg-orange{background:rgba(249,115,22,.15);color:var(--orange)}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:100;display:flex;align-items:center;justify-content:center;padding:16px}
.modal{background:var(--card);border-radius:12px;padding:20px;max-width:600px;width:100%;max-height:85vh;overflow-y:auto;border:1px solid var(--border)}
.modal h3{margin-bottom:12px;font-size:16px}
.form-row{display:flex;gap:10px;margin-bottom:10px;flex-wrap:wrap}
.form-field{flex:1;min-width:140px}
.form-field label{display:block;font-size:12px;color:var(--text2);margin-bottom:4px}
.form-field input,.form-field select,.form-field textarea{width:100%;padding:7px 10px;background:var(--bg);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:13px}
.form-field textarea{resize:vertical;min-height:60px}
.tabs{display:flex;gap:2px;margin-bottom:12px;overflow-x:auto}
.tab{padding:7px 14px;cursor:pointer;border-radius:6px;font-size:13px;color:var(--text2);white-space:nowrap;transition:.15s}
.tab.active{background:var(--pri);color:#fff}
.tag{display:inline-block;padding:2px 6px;border-radius:4px;font-size:11px;margin:1px}
.search-bar{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap}
.search-bar input{flex:1;min-width:200px;padding:7px 12px;background:var(--bg);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:13px}
.search-bar input:focus{outline:none;border-color:var(--pri)}
.toast{position:fixed;top:16px;right:16px;padding:10px 20px;border-radius:8px;color:#fff;z-index:200;animation:fadeIn .3s}
.empty{text-align:center;padding:40px;color:var(--text3)}
/* Grade chart */
.grade-bar{display:flex;align-items:center;gap:8px;margin:4px 0}
.grade-bar .bar{flex:1;height:22px;background:var(--bg);border-radius:4px;overflow:hidden;position:relative}
.grade-bar .fill{height:100%;border-radius:4px;display:flex;align-items:center;padding:0 6px;font-size:11px;color:#fff;font-weight:600;transition:width .5s}
/* Info card */
.info-card{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px}
.info-item{padding:12px;background:var(--bg);border-radius:8px;border:1px solid var(--border)}
.info-item .label{font-size:11px;color:var(--text3);margin-bottom:4px}
.info-item .value{font-size:14px;font-weight:600}
/* Mobile */
@media(max-width:768px){
  .sidebar{position:fixed;left:0;top:0;bottom:0;z-index:50;transform:translateX(-100%)}
  .sidebar.open{transform:translateX(0)}
  .sidebar-mask{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:49;display:none}
  .sidebar-mask.show{display:block}
  .header .menu-btn{display:block}
  .stats{grid-template-columns:repeat(2,1fr)}
  .content{padding:12px}
  .form-row{flex-direction:column}
  .form-field{min-width:100%}
  .login-page{padding:14px}
  .login-card{padding:18px 14px}
  .table-wrap{overflow:visible}
  table,thead,tbody,tr,th,td{display:block}
  thead{display:none}
  tr{border:1px solid var(--border);border-radius:10px;background:var(--card);padding:8px 10px;margin-bottom:10px}
  td{padding:6px 0;border-top:none;white-space:normal}
  td:not(:last-child){border-bottom:1px dashed rgba(148,163,184,.22)}
}
/* Print */
@media print{.sidebar,.header{display:none!important}.content{padding:0!important}}
</style>
</head>
<body>
<div id="login-fallback" class="login-fallback">
  <div class="card login-card">
    <div style="font-size:28px;font-weight:700;color:var(--pri);margin-bottom:4px">渊博579</div>
    <div style="font-size:13px;color:var(--text2);margin-bottom:20px">HR Management System V6</div>
    <div id="fallback-lang" style="display:flex;gap:6px;flex-wrap:wrap;justify-content:center;margin-bottom:12px"></div>
    <div class="form-field" style="text-align:left;margin-bottom:8px">
      <label id="fallback-label-username">用户名</label>
      <input id="fallback-username" type="text" placeholder="请输入用户名" autocomplete="username" />
    </div>
    <div class="form-field" style="text-align:left;margin-bottom:12px">
      <label id="fallback-label-password">密码</label>
      <input id="fallback-password" type="password" placeholder="请输入密码" autocomplete="current-password" />
    </div>
    <button id="fallback-login" class="btn btn-pri" style="width:100%;padding:10px;font-size:15px">登录</button>
    <div id="fallback-result" class="hint" style="display:none"></div>
    <div id="fallback-hint" class="hint">用户名密码需要联系管理员赋予。若页面长时间只显示此界面，请检查网络/CDN加载。</div>
  </div>
</div>
<div id="root"></div>
<script>
(() => {
  const fallback = document.getElementById('login-fallback');
  if(!fallback) return;
  // If the user is already logged in, hide fallback immediately so it does not block the system page
  try {
    const savedToken = localStorage.getItem('hr_token');
    const savedUser = JSON.parse(localStorage.getItem('hr_user'));
    if(savedToken && savedUser && savedUser.username) {
      fallback.style.display = 'none';
    }
  } catch(e) { /* ignore localStorage / JSON parse errors */ }
  const langs = [
    {c:'zh',n:'中文',u:'用户名',p:'密码',l:'登录',h:'用户名密码需要联系管理员赋予。若页面长时间只显示此界面，请检查网络/CDN加载。',phu:'请输入用户名',php:'请输入密码'},
    {c:'en',n:'English',u:'Username',p:'Password',l:'Login',h:'Contact administrator for account credentials. If only this page appears, check CDN/network loading.',phu:'Enter username',php:'Enter password'},
    {c:'de',n:'Deutsch',u:'Benutzer',p:'Passwort',l:'Anmelden',h:'Zugangsdaten bitte beim Administrator anfordern. Wenn nur diese Seite bleibt, CDN/Netzwerk prüfen.',phu:'Benutzer eingeben',php:'Passwort eingeben'},
    {c:'vi',n:'Tiếng Việt',u:'Tên đăng nhập',p:'Mật khẩu',l:'Đăng nhập',h:'Vui lòng liên hệ quản trị viên để được cấp tài khoản. Nếu chỉ thấy màn hình này, hãy kiểm tra CDN/mạng.',phu:'Nhập tên đăng nhập',php:'Nhập mật khẩu'},
    {c:'ar',n:'العربية',u:'اسم المستخدم',p:'كلمة المرور',l:'تسجيل الدخول',h:'يرجى التواصل مع المسؤول لمنح بيانات الدخول. إذا ظهرت هذه الشاشة فقط، تحقق من الشبكة/CDN.',phu:'أدخل اسم المستخدم',php:'أدخل كلمة المرور'},
    {c:'hu',n:'Magyar',u:'Felhasználónév',p:'Jelszó',l:'Bejelentkezés',h:'A belépési adatokért fordulj a rendszergazdához. Ha csak ez a képernyő látszik, ellenőrizd a hálózatot/CDN-t.',phu:'Felhasználónév',php:'Jelszó'}
  ];
  let lang = localStorage.getItem('fallback_lang') || 'zh';
  const map = Object.fromEntries(langs.map(x=>[x.c,x]));
  const langWrap = document.getElementById('fallback-lang');
  const uLabel = document.getElementById('fallback-label-username');
  const pLabel = document.getElementById('fallback-label-password');
  const uInput = document.getElementById('fallback-username');
  const pInput = document.getElementById('fallback-password');
  const btn = document.getElementById('fallback-login');
  const hint = document.getElementById('fallback-hint');
  const result = document.getElementById('fallback-result');

  const showResult = (msg, ok=false) => {
    result.style.display = 'block';
    result.style.color = ok ? 'var(--green)' : 'var(--red)';
    result.textContent = msg;
  };
  const renderLang = () => {
    const cur = map[lang] || map.zh;
    uLabel.textContent = cur.u;
    pLabel.textContent = cur.p;
    btn.textContent = cur.l;
    hint.textContent = cur.h;
    uInput.placeholder = cur.phu;
    pInput.placeholder = cur.php;
    langWrap.innerHTML = '';
    langs.forEach(l => {
      const chip = document.createElement('span');
      chip.textContent = l.n;
      chip.style.cssText = 'cursor:pointer;padding:2px 8px;border-radius:4px;font-size:11px;';
      chip.style.background = l.c===lang ? 'var(--pri)' : 'var(--card2)';
      chip.style.color = l.c===lang ? '#fff' : 'var(--text2)';
      chip.onclick = () => {
        lang = l.c;
        localStorage.setItem('fallback_lang', lang);
        renderLang();
      };
      langWrap.appendChild(chip);
    });
  };
  const doLogin = async () => {
    const username = uInput.value.trim();
    const password = pInput.value;
    if(!username || !password) return showResult('请输入用户名和密码');
    btn.disabled = true;
    try {
      const res = await fetch('/api/login', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({username, password})
      });
      const data = await res.json().catch(() => ({}));
      if(!res.ok || !data.token){
        throw new Error(data.detail || '登录失败');
      }
      localStorage.setItem('hr_token', data.token);
      localStorage.setItem('hr_user', JSON.stringify(data.user || {}));
      showResult('登录成功，正在进入系统...', true);
      setTimeout(() => location.reload(), 300);
    } catch (e) {
      showResult(String(e.message || e));
    } finally {
      btn.disabled = false;
    }
  };
  btn.addEventListener('click', doLogin);
  pInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter') doLogin(); });
  renderLang();
})();
</script>
<script type="text/babel">
const {useState,useEffect,useCallback,useMemo,useRef,createContext,useContext} = React;

// ══════ i18n ══════
const T = {
  zh:{dashboard:'仪表盘',employees:'花名册',suppliers:'供应商',grades:'职级体系',performance:'绩效考核',
    quotation:'报价管理',files:'人员档案',leave:'假期管理',expense:'报销审批',
    timesheet:'工时记录',container:'装卸柜',settlement:'财务结算',schedule:'排班',
    dispatch:'派遣需求',clock:'打卡',messages:'消息',analytics:'数据分析',admin:'权限管理',
    login:'登录',logout:'退出',username:'用户名',password:'密码',search:'搜索',add:'新增',
    edit:'编辑',delete:'删除',export:'导出',approve:'审批',save:'保存',cancel:'取消',
    name:'姓名',grade:'职级',status:'状态',date:'日期',amount:'金额',total:'合计',
    pending:'待审批',approved:'已批准',rejected:'已拒绝',all:'全部',
    mypage:'我的页面',accounts:'账号管理',whsalary:'仓库薪资',warehouse:'仓库管理',docs:'企业文献',
    orgchart:'组织架构',safety:'安全管理',register:'员工申报',compliance:'合规检查'},
  en:{dashboard:'Dashboard',employees:'Employees',suppliers:'Suppliers',grades:'Grade System',performance:'Performance',
    quotation:'Quotation',files:'Employee Files',leave:'Leave Mgmt',expense:'Expense',
    timesheet:'Timesheet',container:'Container',settlement:'Settlement',schedule:'Schedule',
    dispatch:'Dispatch',clock:'Clock',messages:'Messages',analytics:'Analytics',admin:'Admin',
    login:'Login',logout:'Logout',username:'Username',password:'Password',search:'Search',add:'Add',
    edit:'Edit',delete:'Delete',export:'Export',approve:'Approve',save:'Save',cancel:'Cancel',
    name:'Name',grade:'Grade',status:'Status',date:'Date',amount:'Amount',total:'Total',
    pending:'Pending',approved:'Approved',rejected:'Rejected',all:'All',
    mypage:'My Page',accounts:'Accounts',whsalary:'WH Salary',warehouse:'Warehouse Mgmt',docs:'Documents',
    orgchart:'Org Chart',safety:'Safety',register:'Registration',compliance:'Compliance'},
  de:{dashboard:'Dashboard',employees:'Mitarbeiter',suppliers:'Lieferanten',grades:'Stufensystem',performance:'Leistung',
    quotation:'Angebot',files:'Personalakte',leave:'Urlaub',expense:'Spesen',
    timesheet:'Zeiterfassung',container:'Container',settlement:'Abrechnung',schedule:'Dienstplan',
    dispatch:'Disposition',clock:'Stempeluhr',messages:'Nachrichten',analytics:'Analyse',admin:'Admin',
    login:'Anmelden',logout:'Abmelden',username:'Benutzer',password:'Passwort',search:'Suche',add:'Neu',
    edit:'Bearbeiten',delete:'Löschen',export:'Export',approve:'Genehmigen',save:'Speichern',cancel:'Abbrechen',
    name:'Name',grade:'Stufe',status:'Status',date:'Datum',amount:'Betrag',total:'Gesamt',
    pending:'Ausstehend',approved:'Genehmigt',rejected:'Abgelehnt',all:'Alle',
    mypage:'Meine Seite',accounts:'Konten',whsalary:'Lager Gehalt',warehouse:'Lagerverwaltung',docs:'Dokumente',
    orgchart:'Organigramm',safety:'Sicherheit',register:'Anmeldung',compliance:'Compliance'},
  vi:{dashboard:'Bảng điều khiển',employees:'Nhân viên',suppliers:'Nhà cung cấp',grades:'Hệ cấp bậc',performance:'Hiệu suất',
    quotation:'Báo giá',files:'Hồ sơ nhân sự',leave:'Nghỉ phép',expense:'Chi phí',
    timesheet:'Chấm công',container:'Container',settlement:'Quyết toán',schedule:'Lịch làm việc',
    dispatch:'Điều phối',clock:'Chấm giờ',messages:'Tin nhắn',analytics:'Phân tích',admin:'Quản trị',
    login:'Đăng nhập',logout:'Đăng xuất',username:'Tên đăng nhập',password:'Mật khẩu',search:'Tìm kiếm',add:'Thêm',
    edit:'Sửa',delete:'Xóa',export:'Xuất',approve:'Phê duyệt',save:'Lưu',cancel:'Hủy',
    name:'Tên',grade:'Cấp bậc',status:'Trạng thái',date:'Ngày',amount:'Số tiền',total:'Tổng',
    pending:'Chờ duyệt',approved:'Đã duyệt',rejected:'Từ chối',all:'Tất cả',
    mypage:'Trang của tôi',accounts:'Tài khoản',whsalary:'Lương kho',warehouse:'Quản lý kho',docs:'Tài liệu',
    orgchart:'Sơ đồ',safety:'An toàn',register:'Đăng ký',compliance:'Tuân thủ'},
  ar:{dashboard:'لوحة التحكم',employees:'الموظفون',suppliers:'الموردون',grades:'نظام الدرجات',performance:'الأداء',
    quotation:'عروض الأسعار',files:'ملفات الموظفين',leave:'إدارة الإجازات',expense:'المصروفات',
    timesheet:'سجل الساعات',container:'الحاويات',settlement:'التسوية',schedule:'الجدول',
    dispatch:'التوزيع',clock:'الساعة',messages:'الرسائل',analytics:'التحليلات',admin:'الإدارة',
    login:'تسجيل الدخول',logout:'تسجيل الخروج',username:'اسم المستخدم',password:'كلمة المرور',search:'بحث',add:'إضافة',
    edit:'تعديل',delete:'حذف',export:'تصدير',approve:'اعتماد',save:'حفظ',cancel:'إلغاء',
    name:'الاسم',grade:'الدرجة',status:'الحالة',date:'التاريخ',amount:'المبلغ',total:'الإجمالي',
    pending:'قيد الانتظار',approved:'تم الاعتماد',rejected:'مرفوض',all:'الكل',
    mypage:'صفحتي',accounts:'الحسابات',whsalary:'راتب المستودع',warehouse:'إدارة المستودعات',docs:'المستندات',
    orgchart:'الهيكل',safety:'السلامة',register:'التسجيل',compliance:'الامتثال'},
  hu:{dashboard:'Vezérlőpult',employees:'Munkatársak',suppliers:'Beszállítók',grades:'Szint rendszer',performance:'Teljesítmény',
    quotation:'Árajánlat',files:'Személyi akták',leave:'Szabadság',expense:'Költségek',
    timesheet:'Munkaidő',container:'Konténer',settlement:'Elszámolás',schedule:'Beosztás',
    dispatch:'Diszpécselés',clock:'Óra',messages:'Üzenetek',analytics:'Analitika',admin:'Admin',
    login:'Bejelentkezés',logout:'Kijelentkezés',username:'Felhasználónév',password:'Jelszó',search:'Keresés',add:'Új',
    edit:'Szerkesztés',delete:'Törlés',export:'Export',approve:'Jóváhagyás',save:'Mentés',cancel:'Mégse',
    name:'Név',grade:'Szint',status:'Állapot',date:'Dátum',amount:'Összeg',total:'Összesen',
    pending:'Függőben',approved:'Jóváhagyva',rejected:'Elutasítva',all:'Összes',
    mypage:'Saját oldal',accounts:'Fiókok',whsalary:'Raktárbér',warehouse:'Raktárkezelés',docs:'Dokumentumok',
    orgchart:'Szervezet',safety:'Biztonság',register:'Regisztráció',compliance:'Megfelelőség'}
};
const LANGS = [{c:'zh',n:'中文'},{c:'en',n:'English'},{c:'de',n:'Deutsch'},{c:'vi',n:'Tiếng Việt'},{c:'ar',n:'العربية'},{c:'hu',n:'Magyar'}];
const LOCALE_MAP = {zh:'zh-CN',en:'en-US',de:'de-DE',vi:'vi-VN',ar:'ar-SA',hu:'hu-HU'};

// ══════ API Helper ══════
const API = {
  token: localStorage.getItem('hr_token') || '',
  setToken(t){ this.token=t; localStorage.setItem('hr_token',t) },
  async req(method,url,body){
    const opt = {method, headers:{'Content-Type':'application/json'}};
    if(this.token) opt.headers['Authorization'] = 'Bearer '+this.token;
    if(body) opt.body = JSON.stringify(body);
    const r = await fetch(url,opt);
    if(r.status===401){if(url!=='/api/login'&&url!=='/api/pin-login'){this.setToken('');localStorage.removeItem('hr_user');window.location.reload();return null}}
    return r.json();
  },
  get(u){return this.req('GET',u)}, post(u,b){return this.req('POST',u,b)},
  put(u,b){return this.req('PUT',u,b)},
};

// ══════ Toast ══════
let toastTimer;
function showToast(msg,type='success'){
  const el=document.getElementById('toast');
  if(!el)return;
  el.textContent=msg; el.style.display='block';
  el.style.background=type==='success'?'var(--green)':'var(--red)';
  clearTimeout(toastTimer); toastTimer=setTimeout(()=>el.style.display='none',2500);
}

// ══════ Status Badge ══════
const SBadge=({s})=>{
  const m={'在职':'bg-green','离职':'bg-red','已入账':'bg-green','已批准':'bg-green',
    '待仓库审批':'bg-yellow','待财务确认':'bg-orange','待审批':'bg-yellow','已提交':'bg-blue',
    '已拒绝':'bg-red','待审核':'bg-yellow','已通过':'bg-green','已接受':'bg-green',
    '待回复':'bg-cyan','已完成':'bg-green','生效中':'bg-green','已确认':'bg-green',
    '招聘中':'bg-orange','待处理':'bg-yellow','合作中':'bg-green','已付款':'bg-green',
    '已生成':'bg-green','未生成':'bg-yellow','处理中':'bg-orange','已解决':'bg-green','已关闭':'bg-blue',
    '安全事件':'bg-red','客户投诉':'bg-orange','设备故障':'bg-yellow','人员伤害':'bg-red','违规操作':'bg-red',
    '申诉中':'bg-yellow','已班组长审批':'bg-cyan','已仓库审批':'bg-blue','已区域审批':'bg-green'};
  return React.createElement('span',{className:`badge-s ${m[s]||'bg-blue'}`},s);
};

// ══════ Grade Color ══════
const gradeColor=(g)=>{
  const c={'P0':'#94a3b8','P1':'#38bdf8','P2':'#22d3ee','P3':'#34d399','P4':'#a78bfa','P5':'#f472b6',
    'P6':'#fb923c','P7':'#fbbf24','P8':'#ef4444','P9':'#dc2626',
    'M1':'#7dd3fc','M2':'#67e8f9','M3':'#86efac','M4':'#c4b5fd','M5':'#f9a8d4'};
  return c[g]||'var(--pri)';
};

// ══════ Login Page (Optimized - No default credentials shown) ══════
const LoginPage=({onLogin,lang,setLang})=>{
  const [u,setU]=useState('');const[p,setP]=useState('');const[err,setErr]=useState('');const[loading,setLoading]=useState(false);
  const t=T[lang];
  const submit=async()=>{
    if(!u||!p){setErr('请输入用户名和密码');return;}
    setLoading(true);setErr('');
    const r=await API.post('/api/login',{username:u,password:p});
    setLoading(false);
    if(!r||r.detail){setErr(r?.detail||'登录失败');return;}
    API.setToken(r.token);
    localStorage.setItem('hr_user',JSON.stringify(r.user||{}));
    onLogin(r.user);
  };
  return React.createElement('div',{className:'login-page'},
    React.createElement('div',{className:'card fade login-card'},
      React.createElement('div',{style:{fontSize:28,fontWeight:700,color:'var(--pri)',marginBottom:4}},'渊博579'),
      React.createElement('div',{style:{fontSize:13,color:'var(--text2)',marginBottom:20}},'HR Management System V6'),
      React.createElement('div',{style:{display:'flex',justifyContent:'center',gap:6,marginBottom:16}},
        LANGS.map(l=>React.createElement('span',{key:l.c,onClick:()=>setLang(l.c),
          style:{cursor:'pointer',padding:'3px 8px',borderRadius:4,fontSize:12,
            background:lang===l.c?'var(--pri)':'var(--card2)',color:lang===l.c?'#fff':'var(--text2)'}},l.n))),
      err&&React.createElement('div',{style:{color:'var(--red)',fontSize:13,marginBottom:8}},err),
      React.createElement('div',{className:'form-field',style:{textAlign:'left',marginBottom:8}},
        React.createElement('label',null,t.username),
        React.createElement('input',{value:u,onChange:e=>setU(e.target.value),placeholder:'请输入用户名',autoComplete:'username',
          style:{width:'100%',padding:'10px 12px',background:'var(--bg)',border:'1px solid var(--border)',borderRadius:6,color:'var(--text)',fontSize:14}})),
      React.createElement('div',{className:'form-field',style:{textAlign:'left',marginBottom:16}},
        React.createElement('label',null,t.password),
        React.createElement('input',{type:'password',value:p,onChange:e=>setP(e.target.value),placeholder:'请输入密码',autoComplete:'current-password',
          onKeyDown:e=>e.key==='Enter'&&submit(),
          style:{width:'100%',padding:'10px 12px',background:'var(--bg)',border:'1px solid var(--border)',borderRadius:6,color:'var(--text)',fontSize:14}})),
      React.createElement('button',{className:'btn btn-pri',onClick:submit,disabled:loading,style:{width:'100%',padding:10,fontSize:15}},
        loading?'登录中...':t.login),
      React.createElement('div',{style:{marginTop:16,fontSize:11,color:'var(--text3)'}},'用户名密码需要联系管理员赋予')
    ));
};

// ══════ Dashboard ══════
const DashPage=({t})=>{
  const[d,setD]=useState(null);
  useEffect(()=>{API.get('/api/analytics/dashboard').then(setD)},[]);
  if(!d)return React.createElement('div',{className:'empty'},'加载中...');
  return React.createElement('div',{className:'fade'},
    React.createElement('div',{className:'stats'},
      [{n:d.total_emp,l:'在职员工',c:'var(--pri)'},{n:d.own,l:'自有员工',c:'var(--green)'},
       {n:d.supplier,l:'供应商员工',c:'var(--orange)'},{n:d.wh_count,l:'仓库数',c:'var(--cyan)'},
       {n:d.pending_ts,l:'待审工时',c:'var(--yellow)'},{n:d.pending_leave,l:'待审假条',c:'var(--red)'},
       {n:d.pending_expense,l:'待审报销',c:'var(--orange)'},{n:Math.round(d.monthly_hrs),l:'本月总工时',c:'var(--pri2)'}
      ].map((s,i)=>React.createElement('div',{key:i,className:'stat'},
        React.createElement('div',{className:'num',style:{color:s.c}},s.n),
        React.createElement('div',{className:'label'},s.l)))),
    React.createElement('div',{style:{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}},
      React.createElement('div',{className:'card'},
        React.createElement('h4',{style:{marginBottom:10}},'职级分布'),
        d.grade_dist.map(g=>React.createElement('div',{key:g.grade,className:'grade-bar'},
          React.createElement('span',{style:{width:28,fontWeight:600,color:gradeColor(g.grade)}},g.grade),
          React.createElement('div',{className:'bar'},
            React.createElement('div',{className:'fill',style:{width:`${Math.min(g.c/d.total_emp*100,100)*3}%`,background:gradeColor(g.grade)}},g.c))))),
      React.createElement('div',{className:'card'},
        React.createElement('h4',{style:{marginBottom:10}},'仓库人员'),
        d.wh_dist.map(w=>React.createElement('div',{key:w.w,className:'grade-bar'},
          React.createElement('span',{style:{width:40,fontWeight:600}},w.w||'-'),
          React.createElement('div',{className:'bar'},
            React.createElement('div',{className:'fill',style:{width:`${Math.min(w.c/d.total_emp*100,100)*3}%`,background:'var(--pri)'}},w.c)))))));
};

// ══════ My Page (Employee Personal Page) ══════
const MyPage=({t,user})=>{
  const[data,setData]=useState(null);const[salaryConfig,setSalaryConfig]=useState([]);
  const[tab,setTab]=useState('info');const[payslips,setPayslips]=useState([]);
  const[disputeId,setDisputeId]=useState(null);const[disputeReason,setDisputeReason]=useState('');
  useEffect(()=>{
    API.get('/api/mypage').then(setData);
    API.get('/api/mypage/salary-config').then(r=>setSalaryConfig(r?.configs||[]));
    API.get('/api/mypage/payslips').then(r=>setPayslips(r||[]));
  },[]);
  if(!data)return React.createElement('div',{className:'empty'},'加载中...');
  const emp=data.employee;
  const leaveMap={annual:'年假',sick:'病假',personal:'事假'};
  const confirmPayslip=(id)=>{API.post(`/api/payslips/${id}/confirm`).then(()=>{
    toast('已确认工资条');API.get('/api/mypage/payslips').then(r=>setPayslips(r||[]))})};
  const submitDispute=(id)=>{if(!disputeReason)return toast('请填写申诉原因');
    API.post(`/api/payslips/${id}/dispute`,{reason:disputeReason}).then(()=>{
      toast('申诉已提交');setDisputeId(null);setDisputeReason('');
      API.get('/api/mypage/payslips').then(r=>setPayslips(r||[]))})};
  return React.createElement('div',{className:'fade'},
    React.createElement('div',{className:'card',style:{textAlign:'center',paddingBottom:20}},
      React.createElement('div',{style:{width:80,height:80,borderRadius:'50%',background:'var(--pri)',margin:'0 auto 12px',
        display:'flex',alignItems:'center',justifyContent:'center',fontSize:32,color:'#fff'}},emp.name?.charAt(0)),
      React.createElement('div',{style:{fontSize:20,fontWeight:700}},emp.name),
      React.createElement('div',{style:{color:'var(--text2)',marginTop:4}},emp.id,' · ',
        React.createElement('span',{style:{color:gradeColor(emp.grade),fontWeight:600}},emp.grade)),
      React.createElement('div',{style:{marginTop:8}},
        React.createElement(SBadge,{s:emp.status}),' ',
        React.createElement('span',{className:'badge-s bg-blue'},emp.primary_wh))),
    React.createElement('div',{className:'tabs'},
      [['info','基本信息'],['salary','薪资配置'],['timesheet','工时记录'],['payslip','工资条'],['leave','假期余额']].map(([k,l])=>
        React.createElement('div',{key:k,className:`tab ${tab===k?'active':''}`,onClick:()=>setTab(k)},l))),
    tab==='info'&&React.createElement('div',{className:'card'},
      React.createElement('div',{className:'info-card'},
        [{l:'工号',v:emp.id},{l:'姓名',v:emp.name},{l:'职级',v:emp.grade},{l:'岗位',v:emp.position},
         {l:'主仓库',v:emp.primary_wh},{l:'派遣仓库',v:emp.dispatch_whs||'-'},{l:'来源',v:emp.source},
         {l:'入职日期',v:emp.join_date},{l:'电话',v:emp.phone||'-'},{l:'邮箱',v:emp.email||'-'},
         {l:'国籍',v:emp.nationality},{l:'性别',v:emp.gender||'-'},{l:'生日',v:emp.birth_date||'-'},
         {l:'婚姻状况',v:emp.marital_status||'-'},{l:'税号',v:emp.tax_no||'-'},{l:'税级',v:emp.tax_class||'-'},
         {l:'社保号',v:emp.ssn||'-'},{l:'医疗保险',v:emp.health_insurance||'-'},{l:'银行账号(IBAN)',v:emp.iban||'-'},
         {l:'结算方式',v:emp.settle_method||'-'},{l:'每周工时',v:(emp.work_hours_per_week||40)+'h'},
         {l:'语言',v:emp.languages||'-'},{l:'地址',v:emp.address||'-'}
        ].map((it,i)=>React.createElement('div',{key:i,className:'info-item'},
          React.createElement('div',{className:'label'},it.l),
          React.createElement('div',{className:'value'},it.v))))),
    tab==='salary'&&React.createElement('div',null,
      React.createElement('div',{className:'stats',style:{marginBottom:12}},
        [{n:`€${data.monthly_stats?.pay?.toFixed(2)||0}`,l:'本月应发',c:'var(--green)'},
         {n:`€${data.monthly_stats?.net?.toFixed(2)||0}`,l:'本月实发',c:'var(--pri)'},
         {n:`${data.monthly_stats?.hours?.toFixed(1)||0}h`,l:'本月工时',c:'var(--cyan)'}
        ].map((s,i)=>React.createElement('div',{key:i,className:'stat'},
          React.createElement('div',{className:'num',style:{color:s.c}},s.n),
          React.createElement('div',{className:'label'},s.l)))),
      React.createElement('div',{className:'card'},
        React.createElement('h4',{style:{marginBottom:12}},'各仓库薪资配置'),
        salaryConfig.length===0?React.createElement('div',{className:'empty'},'暂无配置'):
        React.createElement('div',{className:'table-wrap'},
          React.createElement('table',null,
            React.createElement('thead',null,React.createElement('tr',null,
              ['仓库','岗位','时薪','20GP','40GP','45HC','夜班%','周末%','绩效基数'].map(h=>React.createElement('th',{key:h},h)))),
            React.createElement('tbody',null,salaryConfig.map((c,i)=>React.createElement('tr',{key:i},
              React.createElement('td',null,c.warehouse_name||c.warehouse_code),
              React.createElement('td',null,c.position_type),
              React.createElement('td',{style:{color:'var(--green)',fontWeight:700}},`€${c.hourly_rate}`),
              React.createElement('td',null,c.container_rate_20gp?`€${c.container_rate_20gp}`:'-'),
              React.createElement('td',null,c.container_rate_40gp?`€${c.container_rate_40gp}`:'-'),
              React.createElement('td',null,c.container_rate_45hc?`€${c.container_rate_45hc}`:'-'),
              React.createElement('td',null,`+${c.night_bonus_pct}%`),
              React.createElement('td',null,`+${c.weekend_bonus_pct}%`),
              React.createElement('td',null,`€${c.perf_base}`)))))))),
    tab==='timesheet'&&React.createElement('div',{className:'card'},
      React.createElement('h4',{style:{marginBottom:12}},'最近工时记录'),
      React.createElement('div',{className:'table-wrap'},
        React.createElement('table',null,
          React.createElement('thead',null,React.createElement('tr',null,
            ['日期','仓库','时段','工时','应发','实发','状态'].map(h=>React.createElement('th',{key:h},h)))),
          React.createElement('tbody',null,data.recent_timesheet.map((r,i)=>React.createElement('tr',{key:i},
            React.createElement('td',null,r.work_date),React.createElement('td',null,r.warehouse_code),
            React.createElement('td',null,`${r.start_time}-${r.end_time}`),
            React.createElement('td',{style:{fontWeight:600}},r.hours+'h'),
            React.createElement('td',{style:{color:'var(--green)'}},`€${r.hourly_pay}`),
            React.createElement('td',{style:{fontWeight:600}},`€${r.net_pay}`),
            React.createElement('td',null,React.createElement(SBadge,{s:r.wh_status})))))))),
    tab==='payslip'&&React.createElement('div',{className:'card'},
      React.createElement('h4',{style:{marginBottom:12}},'我的工资条'),
      payslips.length===0?React.createElement('div',{className:'empty'},'暂无工资条'):
      React.createElement('div',{className:'table-wrap'},
        React.createElement('table',null,
          React.createElement('thead',null,React.createElement('tr',null,
            ['月份','总工时','应发','社保','税费','实发','状态','操作'].map(h=>React.createElement('th',{key:h},h)))),
          React.createElement('tbody',null,payslips.map((p,i)=>React.createElement('tr',{key:i},
            React.createElement('td',null,p.month),
            React.createElement('td',null,p.total_hours?.toFixed(1)+'h'),
            React.createElement('td',{style:{color:'var(--green)'}},`€${p.gross_pay?.toFixed(2)}`),
            React.createElement('td',null,`€${p.ssi_deduct?.toFixed(2)}`),
            React.createElement('td',null,`€${p.tax_deduct?.toFixed(2)}`),
            React.createElement('td',{style:{fontWeight:700}},`€${p.net_pay?.toFixed(2)}`),
            React.createElement('td',null,React.createElement(SBadge,{s:p.status})),
            React.createElement('td',null,
              p.status==='待确认'&&React.createElement('button',{className:'btn-sm',onClick:()=>confirmPayslip(p.id)},'✓ 确认'),
              p.status!=='申诉中'&&React.createElement('button',{className:'btn-sm',style:{marginLeft:4,background:'var(--red)'},
                onClick:()=>setDisputeId(p.id)},'申诉'))))))),
      disputeId&&React.createElement('div',{className:'modal-overlay',onClick:()=>setDisputeId(null)},
        React.createElement('div',{className:'modal',onClick:e=>e.stopPropagation()},
          React.createElement('h3',null,'薪资申诉'),
          React.createElement('textarea',{className:'input',rows:4,placeholder:'请描述申诉原因...',
            value:disputeReason,onChange:e=>setDisputeReason(e.target.value)}),
          React.createElement('div',{style:{display:'flex',gap:8,marginTop:12,justifyContent:'flex-end'}},
            React.createElement('button',{className:'btn ghost',onClick:()=>setDisputeId(null)},'取消'),
            React.createElement('button',{className:'btn',onClick:()=>submitDispute(disputeId)},'提交申诉'))))),
    tab==='leave'&&React.createElement('div',{className:'card'},
      React.createElement('h4',{style:{marginBottom:12}},'假期余额'),
      React.createElement('div',{style:{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(180px,1fr))',gap:12}},
        data.leave_balances.map((lb,i)=>React.createElement('div',{key:i,style:{background:'var(--bg)',padding:16,borderRadius:8,textAlign:'center'}},
          React.createElement('div',{style:{fontSize:13,color:'var(--text2)',marginBottom:8}},leaveMap[lb.leave_type]||lb.leave_type),
          React.createElement('div',{style:{fontSize:24,fontWeight:700,color:'var(--green)'}},lb.remaining_days),
          React.createElement('div',{style:{fontSize:11,color:'var(--text3)'}},`已用 ${lb.used_days} / 共 ${lb.total_days} 天`))))));
};

// ══════ Account Management ══════
const AccountPage=({t})=>{
  const[accounts,setAccounts]=useState([]);const[selIds,setSelIds]=useState([]);const[showModal,setShowModal]=useState(null);
  const load=()=>API.get('/api/accounts').then(setAccounts);
  useEffect(()=>{load()},[]);
  const generateSingle=async(eid)=>{
    const r=await API.post('/api/accounts/generate',{employee_id:eid,role:'worker'});
    if(r?.ok){
      showToast(`账号已生成: ${r.username} / ${r.password}`);
      setShowModal({type:'result',data:[{...r}]});
      load();
    }else showToast('生成失败','error');
  };
  const generateBatch=async()=>{
    const ids=accounts.filter(a=>!a.has_account&&selIds.includes(a.id)).map(a=>a.id);
    if(!ids.length){showToast('请选择未生成账号的员工','error');return;}
    const r=await API.post('/api/accounts/batch-generate',{employee_ids:ids,role:'worker'});
    if(r?.ok){
      showToast(`已生成 ${r.accounts.length} 个账号`);
      setShowModal({type:'result',data:r.accounts});
      setSelIds([]);load();
    }else showToast('批量生成失败','error');
  };
  const resetPwd=async(username)=>{
    const r=await API.post('/api/accounts/reset-password',{username});
    if(r?.ok){
      showToast(`新密码: ${r.password}`);
      setShowModal({type:'result',data:[{username,password:r.password,name:''}]});
    }else showToast('重置失败','error');
  };
  const toggleAll=(e)=>{
    if(e.target.checked)setSelIds(accounts.map(a=>a.id));
    else setSelIds([]);
  };
  const toggleOne=(id)=>{
    if(selIds.includes(id))setSelIds(selIds.filter(i=>i!==id));
    else setSelIds([...selIds,id]);
  };
  return React.createElement('div',{className:'fade'},
    React.createElement('div',{style:{display:'flex',gap:8,marginBottom:12}},
      React.createElement('button',{className:'btn btn-pri',onClick:generateBatch},'批量生成账号'),
      React.createElement('span',{style:{color:'var(--text2)',fontSize:13,lineHeight:'32px'}},`已选 ${selIds.length} 人`)),
    React.createElement('div',{className:'table-wrap'},
      React.createElement('table',null,
        React.createElement('thead',null,React.createElement('tr',null,
          React.createElement('th',null,React.createElement('input',{type:'checkbox',onChange:toggleAll,checked:selIds.length===accounts.length&&accounts.length>0})),
          ['工号','姓名','职级','仓库','状态','账号','操作'].map(h=>React.createElement('th',{key:h},h)))),
        React.createElement('tbody',null,accounts.map(a=>React.createElement('tr',{key:a.id},
          React.createElement('td',null,React.createElement('input',{type:'checkbox',checked:selIds.includes(a.id),onChange:()=>toggleOne(a.id)})),
          React.createElement('td',null,a.id),React.createElement('td',null,a.name),
          React.createElement('td',{style:{color:gradeColor(a.grade),fontWeight:600}},a.grade),
          React.createElement('td',null,a.primary_wh),
          React.createElement('td',null,React.createElement(SBadge,{s:a.status})),
          React.createElement('td',null,a.has_account?
            React.createElement('span',{style:{color:'var(--green)'}},a.username):
            React.createElement('span',{style:{color:'var(--text3)'}},'未生成')),
          React.createElement('td',null,
            !a.has_account?React.createElement('button',{className:'btn btn-sm btn-pri',onClick:()=>generateSingle(a.id)},'生成'):
            React.createElement('button',{className:'btn btn-sm btn-ghost',onClick:()=>resetPwd(a.username)},'重置密码'))))))),
    showModal&&React.createElement('div',{className:'modal-overlay',onClick:()=>setShowModal(null)},
      React.createElement('div',{className:'modal',onClick:e=>e.stopPropagation()},
        React.createElement('h3',null,'账号信息'),
        React.createElement('div',{style:{background:'var(--bg)',padding:12,borderRadius:8,marginBottom:12}},
          showModal.data.map((acc,i)=>React.createElement('div',{key:i,style:{marginBottom:8,padding:8,background:'var(--card2)',borderRadius:6}},
            React.createElement('div',null,React.createElement('b',null,acc.name||acc.username)),
            React.createElement('div',{style:{fontSize:13,color:'var(--text2)'}},'用户名: ',React.createElement('span',{style:{color:'var(--pri)'}},acc.username)),
            React.createElement('div',{style:{fontSize:13,color:'var(--text2)'}},'密码: ',React.createElement('span',{style:{color:'var(--green)'}},acc.password))))),
        React.createElement('div',{style:{color:'var(--yellow)',fontSize:12,marginBottom:12}},'⚠️ 请妥善保存密码，关闭后无法再次查看'),
        React.createElement('button',{className:'btn btn-pri',onClick:()=>setShowModal(null)},'确定'))));
};

// ══════ Warehouse Salary Config ══════
const WHSalaryPage=({t})=>{
  const[configs,setConfigs]=useState([]);const[whs,setWhs]=useState([]);const[selWh,setSelWh]=useState('');
  const[showEdit,setShowEdit]=useState(null);
  useEffect(()=>{
    API.get('/api/warehouses').then(setWhs);
    API.get('/api/warehouse-salary-config').then(setConfigs);
  },[]);
  const filtered=selWh?configs.filter(c=>c.warehouse_code===selWh):configs;
  const save=async()=>{
    if(showEdit.id){
      await API.put(`/api/warehouse-salary-config/${showEdit.id}`,showEdit);
    }else{
      await API.post('/api/warehouse-salary-config',showEdit);
    }
    showToast('保存成功');setShowEdit(null);
    API.get('/api/warehouse-salary-config').then(setConfigs);
  };
  return React.createElement('div',{className:'fade'},
    React.createElement('div',{className:'search-bar'},
      React.createElement('select',{value:selWh,onChange:e=>setSelWh(e.target.value),
        style:{padding:'7px 12px',background:'var(--bg)',border:'1px solid var(--border)',borderRadius:6,color:'var(--text)'}},
        React.createElement('option',{value:''},'全部仓库'),
        whs.map(w=>React.createElement('option',{key:w.code,value:w.code},`${w.code} - ${w.name}`))),
      React.createElement('button',{className:'btn btn-pri',onClick:()=>setShowEdit({warehouse_code:'',grade:'',position_type:'库内',hourly_rate:0,
        container_rate_20gp:0,container_rate_40gp:0,container_rate_45hc:0,night_bonus_pct:25,weekend_bonus_pct:50,holiday_bonus_pct:100,
        perf_base:0,perf_excellent_bonus:0,perf_good_bonus:0,settle_method:'按小时'})},'新增配置')),
    React.createElement('div',{className:'table-wrap'},
      React.createElement('table',null,
        React.createElement('thead',null,React.createElement('tr',null,
          ['仓库','职级','岗位','时薪','20GP','40GP','45HC','夜班%','周末%','节假%','绩效基数','操作'].map(h=>React.createElement('th',{key:h},h)))),
        React.createElement('tbody',null,filtered.map(c=>React.createElement('tr',{key:c.id},
          React.createElement('td',null,c.warehouse_code),
          React.createElement('td',{style:{color:gradeColor(c.grade),fontWeight:600}},c.grade),
          React.createElement('td',null,c.position_type),
          React.createElement('td',{style:{color:'var(--green)',fontWeight:700}},`€${c.hourly_rate}`),
          React.createElement('td',null,c.container_rate_20gp?`€${c.container_rate_20gp}`:'-'),
          React.createElement('td',null,c.container_rate_40gp?`€${c.container_rate_40gp}`:'-'),
          React.createElement('td',null,c.container_rate_45hc?`€${c.container_rate_45hc}`:'-'),
          React.createElement('td',null,`+${c.night_bonus_pct}%`),
          React.createElement('td',null,`+${c.weekend_bonus_pct}%`),
          React.createElement('td',null,`+${c.holiday_bonus_pct}%`),
          React.createElement('td',null,`€${c.perf_base}`),
          React.createElement('td',null,React.createElement('button',{className:'btn btn-sm btn-ghost',onClick:()=>setShowEdit(c)},'编辑'))))))),
    showEdit&&React.createElement('div',{className:'modal-overlay',onClick:()=>setShowEdit(null)},
      React.createElement('div',{className:'modal',onClick:e=>e.stopPropagation()},
        React.createElement('h3',null,showEdit.id?'编辑薪资配置':'新增薪资配置'),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},
            React.createElement('label',null,'仓库'),
            React.createElement('select',{value:showEdit.warehouse_code,onChange:e=>setShowEdit({...showEdit,warehouse_code:e.target.value}),disabled:!!showEdit.id},
              React.createElement('option',{value:''},'选择仓库'),
              whs.map(w=>React.createElement('option',{key:w.code,value:w.code},w.code)))),
          React.createElement('div',{className:'form-field'},
            React.createElement('label',null,'职级'),
            React.createElement('select',{value:showEdit.grade,onChange:e=>setShowEdit({...showEdit,grade:e.target.value}),disabled:!!showEdit.id},
              React.createElement('option',{value:''},'选择职级'),
              ['P0','P1','P2','P3','P4','P5','P6','P7','M1','M2','M3'].map(g=>React.createElement('option',{key:g,value:g},g)))),
          React.createElement('div',{className:'form-field'},
            React.createElement('label',null,'岗位类型'),
            React.createElement('select',{value:showEdit.position_type,onChange:e=>setShowEdit({...showEdit,position_type:e.target.value}),disabled:!!showEdit.id},
              ['库内','装卸','管理'].map(p=>React.createElement('option',{key:p,value:p},p))))),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'时薪(€)'),
            React.createElement('input',{type:'number',step:'0.5',value:showEdit.hourly_rate,onChange:e=>setShowEdit({...showEdit,hourly_rate:parseFloat(e.target.value)||0})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'结算方式'),
            React.createElement('select',{value:showEdit.settle_method,onChange:e=>setShowEdit({...showEdit,settle_method:e.target.value})},
              ['按小时','按柜','按件'].map(m=>React.createElement('option',{key:m,value:m},m))))),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'20GP柜(€)'),
            React.createElement('input',{type:'number',value:showEdit.container_rate_20gp,onChange:e=>setShowEdit({...showEdit,container_rate_20gp:parseFloat(e.target.value)||0})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'40GP柜(€)'),
            React.createElement('input',{type:'number',value:showEdit.container_rate_40gp,onChange:e=>setShowEdit({...showEdit,container_rate_40gp:parseFloat(e.target.value)||0})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'45HC柜(€)'),
            React.createElement('input',{type:'number',value:showEdit.container_rate_45hc,onChange:e=>setShowEdit({...showEdit,container_rate_45hc:parseFloat(e.target.value)||0})}))),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'夜班加成%'),
            React.createElement('input',{type:'number',value:showEdit.night_bonus_pct,onChange:e=>setShowEdit({...showEdit,night_bonus_pct:parseFloat(e.target.value)||0})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'周末加成%'),
            React.createElement('input',{type:'number',value:showEdit.weekend_bonus_pct,onChange:e=>setShowEdit({...showEdit,weekend_bonus_pct:parseFloat(e.target.value)||0})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'节假日加成%'),
            React.createElement('input',{type:'number',value:showEdit.holiday_bonus_pct,onChange:e=>setShowEdit({...showEdit,holiday_bonus_pct:parseFloat(e.target.value)||0})}))),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'绩效基数(€)'),
            React.createElement('input',{type:'number',value:showEdit.perf_base,onChange:e=>setShowEdit({...showEdit,perf_base:parseFloat(e.target.value)||0})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'优秀奖金(€)'),
            React.createElement('input',{type:'number',value:showEdit.perf_excellent_bonus,onChange:e=>setShowEdit({...showEdit,perf_excellent_bonus:parseFloat(e.target.value)||0})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'良好奖金(€)'),
            React.createElement('input',{type:'number',value:showEdit.perf_good_bonus,onChange:e=>setShowEdit({...showEdit,perf_good_bonus:parseFloat(e.target.value)||0})}))),
        React.createElement('div',{style:{display:'flex',gap:8,marginTop:16}},
          React.createElement('button',{className:'btn btn-pri',onClick:save},'保存'),
          React.createElement('button',{className:'btn btn-ghost',onClick:()=>setShowEdit(null)},'取消')))));
};

// ══════ Employees ══════
const EmpPage=({t})=>{
  const[emps,setEmps]=useState([]);const[q,setQ]=useState('');const[showEdit,setShowEdit]=useState(null);
  useEffect(()=>{API.get('/api/employees').then(setEmps)},[]);
  const filtered=emps.filter(e=>`${e.name}${e.id}${e.grade}${e.primary_wh}`.includes(q));
  const save=async()=>{
    if(showEdit._isNew){const d={...showEdit};delete d._isNew;await API.post('/api/employees',d);}
    else{await API.put(`/api/employees/${showEdit.id}`,showEdit);}
    showToast('保存成功');setShowEdit(null);API.get('/api/employees').then(setEmps);
  };
  const doExport=async()=>{const r=await API.get('/api/export/employees');if(r&&r.data){const blob=new Blob([JSON.stringify(r.data,null,2)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='employees.json';a.click();showToast('导出成功');}};
  const doImport=()=>{const inp=document.createElement('input');inp.type='file';inp.accept='.json';inp.onchange=async e=>{const f=e.target.files[0];if(!f)return;const text=await f.text();try{const data=JSON.parse(text);const arr=Array.isArray(data)?data:data.data||[];const r=await API.post('/api/import/employees',{data:arr});showToast(`导入完成: ${r.success||0} 条成功`);API.get('/api/employees').then(setEmps);}catch(err){showToast('导入失败: '+err.message,'error');}};inp.click();};
  return React.createElement('div',{className:'fade'},
    React.createElement('div',{className:'search-bar'},
      React.createElement('input',{value:q,onChange:e=>setQ(e.target.value),placeholder:'🔍 搜索姓名/工号/职级...'}),
      React.createElement('button',{className:'btn btn-pri',onClick:()=>setShowEdit({_isNew:true,name:'',phone:'',email:'',grade:'P1',position:'库内',primary_wh:'',source:'自有',status:'在职',gender:'男',nationality:'CN'})},'新增员工'),
      React.createElement('button',{className:'btn btn-ghost',onClick:doExport},'📤 导出'),
      React.createElement('button',{className:'btn btn-ghost',onClick:doImport},'📥 导入')),
    React.createElement('div',{className:'table-wrap'},
      React.createElement('table',null,
        React.createElement('thead',null,React.createElement('tr',null,
          ['工号','姓名','职级','岗位','仓库','来源','状态','操作'].map(h=>React.createElement('th',{key:h},h)))),
        React.createElement('tbody',null,filtered.map(e=>React.createElement('tr',{key:e.id},
          React.createElement('td',null,e.id),
          React.createElement('td',null,React.createElement('b',null,e.name)),
          React.createElement('td',{style:{color:gradeColor(e.grade),fontWeight:700}},e.grade),
          React.createElement('td',null,e.position),
          React.createElement('td',null,e.primary_wh),
          React.createElement('td',null,React.createElement(SBadge,{s:e.source==='自有'?'自有':'供应商'})),
          React.createElement('td',null,React.createElement(SBadge,{s:e.status})),
          React.createElement('td',null,React.createElement('button',{className:'btn btn-sm btn-ghost',onClick:()=>setShowEdit(e)},'编辑'))))))),
    showEdit&&React.createElement('div',{className:'modal-overlay',onClick:()=>setShowEdit(null)},
      React.createElement('div',{className:'modal',style:{maxWidth:700},onClick:e=>e.stopPropagation()},
        React.createElement('h3',null,showEdit._isNew?'新增员工 / Neuer Mitarbeiter':'编辑员工 / Mitarbeiter bearbeiten'),
        React.createElement('div',{style:{fontSize:12,color:'var(--text3)',marginBottom:10}},'基本信息 / Grunddaten'),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'姓名 / Name'),
            React.createElement('input',{value:showEdit.name||'',onChange:e=>setShowEdit({...showEdit,name:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'姓 / Familienname'),
            React.createElement('input',{value:showEdit.family_name||'',onChange:e=>setShowEdit({...showEdit,family_name:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'名 / Vorname'),
            React.createElement('input',{value:showEdit.given_name||'',onChange:e=>setShowEdit({...showEdit,given_name:e.target.value})}))),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'性别 / Geschlecht'),
            React.createElement('select',{value:showEdit.gender||'男',onChange:e=>setShowEdit({...showEdit,gender:e.target.value})},
              ['男','女'].map(g=>React.createElement('option',{key:g,value:g},g)))),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'生日 / Geburtsdatum'),
            React.createElement('input',{type:'date',value:showEdit.birth_date||'',onChange:e=>setShowEdit({...showEdit,birth_date:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'国籍 / Staatsangehörigkeit'),
            React.createElement('input',{value:showEdit.nationality||'',onChange:e=>setShowEdit({...showEdit,nationality:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'婚姻状况 / Familienstand'),
            React.createElement('select',{value:showEdit.marital_status||'',onChange:e=>setShowEdit({...showEdit,marital_status:e.target.value})},
              ['','未婚','已婚','离异','丧偶'].map(s=>React.createElement('option',{key:s,value:s},s||'请选择'))))),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field',style:{flex:2}},React.createElement('label',null,'地址 / Adresse'),
            React.createElement('input',{value:showEdit.address||'',onChange:e=>setShowEdit({...showEdit,address:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'电话 / Telefon'),
            React.createElement('input',{value:showEdit.phone||'',onChange:e=>setShowEdit({...showEdit,phone:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'邮箱 / E-Mail'),
            React.createElement('input',{value:showEdit.email||'',onChange:e=>setShowEdit({...showEdit,email:e.target.value})}))),
        React.createElement('div',{style:{fontSize:12,color:'var(--text3)',marginTop:12,marginBottom:10}},'税务与保险 / Steuer & Versicherung'),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'社保号(SSN) / Sozialvers.-Nr.'),
            React.createElement('input',{value:showEdit.ssn||'',onChange:e=>setShowEdit({...showEdit,ssn:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'税号 / Steuer-Nr.'),
            React.createElement('input',{value:showEdit.tax_no||'',onChange:e=>setShowEdit({...showEdit,tax_no:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'税号ID / Steuer-ID'),
            React.createElement('input',{value:showEdit.tax_id||'',onChange:e=>setShowEdit({...showEdit,tax_id:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'税级 / Steuerklasse'),
            React.createElement('select',{value:showEdit.tax_class||'1',onChange:e=>setShowEdit({...showEdit,tax_class:e.target.value})},
              ['1','2','3','4','5','6'].map(c=>React.createElement('option',{key:c,value:c},c))))),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'医疗保险 / Krankenversicherung'),
            React.createElement('input',{value:showEdit.health_insurance||'',onChange:e=>setShowEdit({...showEdit,health_insurance:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'IBAN / Bankverbindung'),
            React.createElement('input',{value:showEdit.iban||'',onChange:e=>setShowEdit({...showEdit,iban:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'报税模式 / Steuermodus'),
            React.createElement('select',{value:showEdit.tax_mode||'我方报税',onChange:e=>setShowEdit({...showEdit,tax_mode:e.target.value})},
              ['我方报税','供应商报税','自行报税'].map(m=>React.createElement('option',{key:m,value:m},m))))),
        React.createElement('div',{style:{fontSize:12,color:'var(--text3)',marginTop:12,marginBottom:10}},'岗位与薪资 / Stelle & Gehalt'),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'职级 / Stufe'),
            React.createElement('select',{value:showEdit.grade||'P1',onChange:e=>setShowEdit({...showEdit,grade:e.target.value})},
              ['P0','P1','P2','P3','P4','P5','P6','P7','P8','P9','M1','M2','M3','M4','M5'].map(g=>React.createElement('option',{key:g,value:g},g)))),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'岗位 / Position'),
            React.createElement('input',{value:showEdit.position||'',onChange:e=>setShowEdit({...showEdit,position:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'主仓库 / Hauptlager'),
            React.createElement('input',{value:showEdit.primary_wh||'',onChange:e=>setShowEdit({...showEdit,primary_wh:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'每周工时 / Wochenstunden'),
            React.createElement('input',{type:'number',value:showEdit.work_hours_per_week||40,onChange:e=>setShowEdit({...showEdit,work_hours_per_week:parseFloat(e.target.value)||40})}))),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'时薪(€/h) / Stundenlohn'),
            React.createElement('input',{type:'number',step:'0.5',value:showEdit.hourly_rate||12,onChange:e=>setShowEdit({...showEdit,hourly_rate:parseFloat(e.target.value)||12})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'来源 / Herkunft'),
            React.createElement('select',{value:showEdit.source||'自有',onChange:e=>setShowEdit({...showEdit,source:e.target.value})},
              ['自有','供应商'].map(s=>React.createElement('option',{key:s,value:s},s)))),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'供应商 / Lieferant'),
            React.createElement('input',{value:showEdit.supplier_id||'',onChange:e=>setShowEdit({...showEdit,supplier_id:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'状态 / Status'),
            React.createElement('select',{value:showEdit.status||'在职',onChange:e=>setShowEdit({...showEdit,status:e.target.value})},
              ['在职','离职'].map(s=>React.createElement('option',{key:s,value:s},s))))),
        React.createElement('div',{style:{display:'flex',gap:8,justifyContent:'flex-end',marginTop:16}},
          React.createElement('button',{className:'btn btn-ghost',onClick:()=>setShowEdit(null)},'取消 / Abbrechen'),
          React.createElement('button',{className:'btn btn-pri',onClick:save},'保存 / Speichern')))));
};

// ══════ Grades ══════
const GradePage=({t})=>{
  const[grades,setGrades]=useState([]);const[sel,setSel]=useState(null);const[tab,setTab]=useState('运营');
  useEffect(()=>{API.get('/api/grades').then(setGrades)},[]);
  const filtered=grades.filter(g=>g.series===tab);
  return React.createElement('div',{className:'fade'},
    React.createElement('div',{className:'tabs'},
      ['运营','行政'].map(s=>React.createElement('div',{key:s,className:`tab ${tab===s?'active':''}`,onClick:()=>setTab(s)},
        s==='运营'?'运营序列 P0-P9':'行政序列 M1-M5'))),
    React.createElement('div',{style:{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(280px,1fr))',gap:12}},
      filtered.map(g=>{
        let criteria=[];try{criteria=JSON.parse(g.eval_criteria||'[]')}catch{}
        let perf=[];try{perf=JSON.parse(g.perf_dimensions||'[]')}catch{}
        return React.createElement('div',{key:g.code,className:'card',style:{cursor:'pointer',borderColor:sel===g.code?'var(--pri)':'var(--border)'},
          onClick:()=>setSel(sel===g.code?null:g.code)},
          React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:8}},
            React.createElement('div',null,
              React.createElement('span',{style:{fontSize:22,fontWeight:700,color:gradeColor(g.code),marginRight:8}},g.code),
              React.createElement('span',{style:{fontSize:15,fontWeight:600}},g.title_zh)),
            React.createElement('div',{style:{textAlign:'right',fontSize:12}},
              React.createElement('div',{style:{color:'var(--green)',fontWeight:700,fontSize:16}},`€${g.base_salary}/h`),
              React.createElement('div',{style:{color:'var(--text3)'}},g.title_de))),
          React.createElement('div',{style:{fontSize:12,color:'var(--text2)',marginBottom:6}},
            `管理幅度: ${g.manage_scope} | 调价: ${g.adjust_pct_min}%~${g.adjust_pct_max}%`),
          React.createElement('div',{style:{fontSize:12,color:'var(--cyan)'}},`晋升通道: → ${g.promotion_path||'最高级'}`),
          sel===g.code&&React.createElement('div',{style:{marginTop:10,borderTop:'1px solid var(--border)',paddingTop:10}},
            React.createElement('div',{style:{fontWeight:600,marginBottom:6,fontSize:13}},'📋 评定标准:'),
            criteria.map((c,i)=>React.createElement('div',{key:i,style:{fontSize:12,color:'var(--text2)',padding:'2px 0'}},'✅ '+c)),
            perf.length>0&&React.createElement('div',{style:{marginTop:8}},
              React.createElement('div',{style:{fontWeight:600,marginBottom:4,fontSize:13}},'📊 绩效维度:'),
              perf.map((p,i)=>React.createElement('div',{key:i,className:'grade-bar'},
                React.createElement('span',{style:{width:60,fontSize:12}},p.dim),
                React.createElement('div',{className:'bar'},
                  React.createElement('div',{className:'fill',style:{width:`${p.w||p.weight||0}%`,background:'var(--pri)'}},`${p.w||p.weight||0}%`)))))));})));
};

// ══════ Timesheet ══════
const TSPage=({t})=>{
  const[ts,setTs]=useState([]);const[showEdit,setShowEdit]=useState(null);const[emps,setEmps]=useState([]);const[whs,setWhs]=useState([]);
  const[selIds,setSelIds]=useState([]);
  useEffect(()=>{API.get('/api/timesheet').then(setTs);API.get('/api/employees').then(setEmps);API.get('/api/warehouses').then(setWhs);},[]);
  const save=async()=>{
    if(showEdit._isNew){const d={...showEdit};delete d._isNew;await API.post('/api/timesheet',d);}
    else{await API.put(`/api/timesheet/${showEdit.id}`,showEdit);}
    showToast('保存成功');setShowEdit(null);API.get('/api/timesheet').then(setTs);
  };
  const doExport=async()=>{const r=await API.get('/api/export/timesheet');if(r&&r.data){const blob=new Blob([JSON.stringify(r.data,null,2)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='timesheet.json';a.click();showToast('导出成功');}};
  const doImport=()=>{const inp=document.createElement('input');inp.type='file';inp.accept='.json';inp.onchange=async e=>{const f=e.target.files[0];if(!f)return;const text=await f.text();try{const data=JSON.parse(text);const arr=Array.isArray(data)?data:data.data||[];const r=await API.post('/api/import/timesheet',{data:arr});showToast(`导入完成: ${r.success||0} 条成功`);API.get('/api/timesheet').then(setTs);}catch(err){showToast('导入失败: '+err.message,'error');}};inp.click();};
  const batchApprove=(type)=>{if(!selIds.length)return showToast('请先选择记录');
    API.post('/api/timesheet/batch-approve',{ids:selIds,type}).then(()=>{showToast('审批成功');setSelIds([]);API.get('/api/timesheet').then(setTs)})};
  const toggleSel=(id)=>setSelIds(prev=>prev.includes(id)?prev.filter(x=>x!==id):[...prev,id]);
  const toggleAll=()=>{const visible=ts.slice(0,100).map(r=>r.id);const allSelected=visible.every(id=>selIds.includes(id));setSelIds(allSelected?[]:visible)};
  return React.createElement('div',{className:'fade'},
    React.createElement('div',{className:'search-bar'},
      React.createElement('button',{className:'btn btn-pri',onClick:()=>{const now=new Date().toISOString().slice(0,10);setShowEdit({_isNew:true,employee_id:'',employee_name:'',work_date:now,warehouse_code:'',start_time:'08:00',end_time:'17:00',hours:8,position:'库内',grade:'P1',settle_method:'按小时',base_rate:12,hourly_pay:96,notes:''});}},'新增工时'),
      React.createElement('button',{className:'btn btn-ghost',onClick:doExport},'📤 导出'),
      React.createElement('button',{className:'btn btn-ghost',onClick:doImport},'📥 导入'),
      selIds.length>0&&React.createElement(React.Fragment,null,
        React.createElement('span',{style:{margin:'0 8px',color:'var(--text2)',fontSize:13}},`已选 ${selIds.length} 条`),
        React.createElement('button',{className:'btn-sm',style:{background:'var(--cyan)'},onClick:()=>batchApprove('leader')},'班组长审批'),
        React.createElement('button',{className:'btn-sm',style:{background:'var(--pri)'},onClick:()=>batchApprove('wh')},'驻仓经理审批'),
        React.createElement('button',{className:'btn-sm',style:{background:'#f59e0b'},onClick:()=>batchApprove('regional')},'区域经理审批'),
        React.createElement('button',{className:'btn-sm',style:{background:'var(--green)'},onClick:()=>batchApprove('fin')},'财务确认'))),
    React.createElement('div',{style:{marginBottom:8,color:'var(--text2)',fontSize:13}},`共 ${ts.length} 条记录`),
    React.createElement('div',{className:'table-wrap'},
      React.createElement('table',null,
        React.createElement('thead',null,React.createElement('tr',null,
          React.createElement('th',null,React.createElement('input',{type:'checkbox',checked:selIds.length===ts.slice(0,100).length&&ts.length>0,onChange:toggleAll})),
          ['日期','员工','职级','仓库','岗位','时段','工时','时薪','应付','状态','操作'].map(h=>React.createElement('th',{key:h},h)))),
        React.createElement('tbody',null,ts.slice(0,100).map(r=>React.createElement('tr',{key:r.id},
          React.createElement('td',null,React.createElement('input',{type:'checkbox',checked:selIds.includes(r.id),onChange:()=>toggleSel(r.id)})),
          React.createElement('td',null,r.work_date),React.createElement('td',null,r.employee_name),
          React.createElement('td',{style:{color:gradeColor(r.grade),fontWeight:700}},r.grade),
          React.createElement('td',null,r.warehouse_code),
          React.createElement('td',null,r.position),
          React.createElement('td',null,`${r.start_time}-${r.end_time}`),
          React.createElement('td',{style:{fontWeight:700}},r.hours+'h'),
          React.createElement('td',null,`€${r.base_rate}`),
          React.createElement('td',{style:{color:'var(--green)',fontWeight:700}},`€${r.hourly_pay}`),
          React.createElement('td',null,React.createElement(SBadge,{s:r.wh_status})),
          React.createElement('td',null,React.createElement('button',{className:'btn btn-sm btn-ghost',onClick:()=>setShowEdit(r)},'编辑'))))))),
    showEdit&&React.createElement('div',{className:'modal-overlay',onClick:()=>setShowEdit(null)},
      React.createElement('div',{className:'modal',onClick:e=>e.stopPropagation()},
        React.createElement('h3',null,showEdit._isNew?'新增工时记录':'编辑工时记录'),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'员工'),
            React.createElement('select',{value:showEdit.employee_id||'',onChange:e=>{const emp=emps.find(em=>em.id===e.target.value);setShowEdit({...showEdit,employee_id:e.target.value,employee_name:emp?emp.name:'',grade:emp?emp.grade:showEdit.grade});},disabled:!showEdit._isNew},
              React.createElement('option',{value:''},'选择员工'),
              emps.map(em=>React.createElement('option',{key:em.id,value:em.id},`${em.id} ${em.name}`)))),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'工作日期'),
            React.createElement('input',{type:'date',value:showEdit.work_date||'',onChange:e=>setShowEdit({...showEdit,work_date:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'仓库'),
            React.createElement('select',{value:showEdit.warehouse_code||'',onChange:e=>setShowEdit({...showEdit,warehouse_code:e.target.value})},
              React.createElement('option',{value:''},'选择仓库'),
              whs.map(w=>React.createElement('option',{key:w.code,value:w.code},`${w.code} ${w.name}`))))),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'开始时间'),
            React.createElement('input',{type:'time',value:showEdit.start_time||'',onChange:e=>setShowEdit({...showEdit,start_time:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'结束时间'),
            React.createElement('input',{type:'time',value:showEdit.end_time||'',onChange:e=>setShowEdit({...showEdit,end_time:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'工时(h)'),
            React.createElement('input',{type:'number',value:showEdit.hours||0,onChange:e=>setShowEdit({...showEdit,hours:parseFloat(e.target.value)||0})}))),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'岗位'),
            React.createElement('input',{value:showEdit.position||'',onChange:e=>setShowEdit({...showEdit,position:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'时薪(€)'),
            React.createElement('input',{type:'number',value:showEdit.base_rate||0,onChange:e=>setShowEdit({...showEdit,base_rate:parseFloat(e.target.value)||0})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'备注'),
            React.createElement('input',{value:showEdit.notes||'',onChange:e=>setShowEdit({...showEdit,notes:e.target.value})}))),
        React.createElement('div',{style:{display:'flex',gap:8,justifyContent:'flex-end',marginTop:16}},
          React.createElement('button',{className:'btn btn-ghost',onClick:()=>setShowEdit(null)},'取消'),
          React.createElement('button',{className:'btn btn-pri',onClick:save},'保存')))));
};

// ══════ Settlement ══════
const SettPage=({t})=>{
  const[own,setOwn]=useState([]);const[sup,setSup]=useState([]);const[whIncome,setWhIncome]=useState([]);const[workerExp,setWorkerExp]=useState([]);const[tab,setTab]=useState('own');
  useEffect(()=>{API.get('/api/settlement?mode=own').then(setOwn);API.get('/api/settlement?mode=supplier').then(setSup);API.get('/api/settlement?mode=warehouse_income').then(setWhIncome);API.get('/api/settlement?mode=worker_expense').then(setWorkerExp);},[]);
  return React.createElement('div',{className:'fade'},
    React.createElement('div',{className:'tabs'},
      [['own','自有员工'],['sup','供应商结算'],['wh_income','仓库进账'],['wk_expense','工人出账']].map(([k,l])=>React.createElement('div',{key:k,className:`tab ${tab===k?'active':''}`,onClick:()=>setTab(k)},l))),
    tab==='own'?React.createElement('div',{className:'table-wrap'},
      React.createElement('table',null,
        React.createElement('thead',null,React.createElement('tr',null,
          ['工号','姓名','职级','仓库','工时','应付','社保','税','实发'].map(h=>React.createElement('th',{key:h},h)))),
        React.createElement('tbody',null,own.map(r=>React.createElement('tr',{key:r.employee_id},
          React.createElement('td',null,r.employee_id),React.createElement('td',null,r.employee_name),
          React.createElement('td',{style:{color:gradeColor(r.grade),fontWeight:700}},r.grade),
          React.createElement('td',null,r.warehouse_code),
          React.createElement('td',null,r.h+'h'),React.createElement('td',null,`€${r.pay?.toFixed(2)}`),
          React.createElement('td',null,`-€${r.ssi?.toFixed(2)}`),React.createElement('td',null,`-€${r.tax?.toFixed(2)}`),
          React.createElement('td',{style:{fontWeight:700,color:'var(--green)'}},`€${r.net?.toFixed(2)}`))))))
    :tab==='sup'?React.createElement('div',{className:'table-wrap'},
      React.createElement('table',null,
        React.createElement('thead',null,React.createElement('tr',null,
          ['供应商','仓库','人数','总工时','总费用'].map(h=>React.createElement('th',{key:h},h)))),
        React.createElement('tbody',null,sup.map((r,i)=>React.createElement('tr',{key:i},
          React.createElement('td',null,r.supplier_id),React.createElement('td',null,r.warehouse_code),
          React.createElement('td',null,r.hc),React.createElement('td',null,r.h+'h'),
          React.createElement('td',{style:{fontWeight:700}},`€${r.pay?.toFixed(2)}`))))))
    :tab==='wh_income'?React.createElement('div',{className:'table-wrap'},
      React.createElement('table',null,
        React.createElement('thead',null,React.createElement('tr',null,
          ['仓库','人数','工作天数','总工时','总收入(毛)'].map(h=>React.createElement('th',{key:h},h)))),
        React.createElement('tbody',null,whIncome.map((r,i)=>React.createElement('tr',{key:i},
          React.createElement('td',{style:{fontWeight:700}},r.warehouse_code||'-'),
          React.createElement('td',null,r.headcount||0),React.createElement('td',null,r.work_days||0),
          React.createElement('td',null,(r.total_hours||0)+'h'),
          React.createElement('td',{style:{fontWeight:700,color:'var(--green)'}},`€${(r.gross_income||0).toFixed(2)}`))))))
    :React.createElement('div',{className:'table-wrap'},
      React.createElement('table',null,
        React.createElement('thead',null,React.createElement('tr',null,
          ['工号','姓名','仓库','职级','总工时','时薪','计件','绩效','其他','毛付','社保','税','实发'].map(h=>React.createElement('th',{key:h},h)))),
        React.createElement('tbody',null,workerExp.map((r,i)=>React.createElement('tr',{key:i},
          React.createElement('td',null,r.employee_id),React.createElement('td',null,r.employee_name),
          React.createElement('td',null,r.warehouse_code||'-'),
          React.createElement('td',{style:{color:gradeColor(r.grade),fontWeight:700}},r.grade),
          React.createElement('td',null,(r.total_hours||0)+'h'),
          React.createElement('td',null,`€${(r.hourly_total||0).toFixed(2)}`),
          React.createElement('td',null,`€${(r.piece_total||0).toFixed(2)}`),
          React.createElement('td',null,`€${(r.perf_total||0).toFixed(2)}`),
          React.createElement('td',null,`€${(r.other_total||0).toFixed(2)}`),
          React.createElement('td',{style:{fontWeight:700}},`€${(r.gross_pay||0).toFixed(2)}`),
          React.createElement('td',null,`-€${(r.ssi_total||0).toFixed(2)}`),
          React.createElement('td',null,`-€${(r.tax_total||0).toFixed(2)}`),
          React.createElement('td',{style:{fontWeight:700,color:'var(--green)'}},`€${(r.net_total||0).toFixed(2)}`)))))));
};

// ══════ Leave ══════
const LeavePage=({t})=>{
  const[reqs,setReqs]=useState([]);const[types,setTypes]=useState([]);const[tab,setTab]=useState('req');
  useEffect(()=>{API.get('/api/leave-requests').then(setReqs);API.get('/api/leave-types').then(setTypes);},[]);
  const typeMap=Object.fromEntries(types.map(t=>[t.code,t.name_zh]));
  return React.createElement('div',{className:'fade'},
    React.createElement('div',{className:'tabs'},
      [['req','假条记录'],['type','假期类型']].map(([k,l])=>React.createElement('div',{key:k,className:`tab ${tab===k?'active':''}`,onClick:()=>setTab(k)},l))),
    tab==='req'?React.createElement('div',{className:'table-wrap'},
      React.createElement('table',null,
        React.createElement('thead',null,React.createElement('tr',null,
          ['申请号','员工','职级','类型','开始','结束','天数','原因','状态'].map(h=>React.createElement('th',{key:h},h)))),
        React.createElement('tbody',null,reqs.map(r=>React.createElement('tr',{key:r.id},
          React.createElement('td',null,r.id),React.createElement('td',null,r.employee_name),
          React.createElement('td',{style:{color:gradeColor(r.grade),fontWeight:700}},r.grade),
          React.createElement('td',null,typeMap[r.leave_type]||r.leave_type),
          React.createElement('td',null,r.start_date),React.createElement('td',null,r.end_date),
          React.createElement('td',{style:{fontWeight:700}},r.days),
          React.createElement('td',null,r.reason),
          React.createElement('td',null,React.createElement(SBadge,{s:r.status})))))))
    :React.createElement('div',{style:{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(250px,1fr))',gap:12}},
      types.map(lt=>React.createElement('div',{key:lt.code,className:'card'},
        React.createElement('div',{style:{fontWeight:700,fontSize:15}},lt.name_zh),
        React.createElement('div',{style:{fontSize:12,color:'var(--text2)'}},`${lt.name_en} / ${lt.name_de}`),
        React.createElement('div',{style:{marginTop:6,fontSize:12}},
          React.createElement('span',{className:'badge-s',style:{background:lt.paid?'rgba(34,197,94,.15)':'rgba(239,68,68,.15)',
            color:lt.paid?'var(--green)':'var(--red)'}},lt.paid?'带薪':'无薪'),' ',
          `默认${lt.default_days}天`,lt.requires_proof?' · 需证明':''),
        React.createElement('div',{style:{fontSize:11,color:'var(--text3)',marginTop:4}},lt.description)))));
};

// ══════ Expense ══════
const ExpPage=({t})=>{
  const[exps,setExps]=useState([]);
  useEffect(()=>{API.get('/api/expenses').then(setExps)},[]);
  return React.createElement('div',{className:'fade'},
    React.createElement('div',{className:'table-wrap'},
      React.createElement('table',null,
        React.createElement('thead',null,React.createElement('tr',null,
          ['报销号','员工','职级','类型','金额','日期','描述','状态'].map(h=>React.createElement('th',{key:h},h)))),
        React.createElement('tbody',null,exps.map(e=>React.createElement('tr',{key:e.id},
          React.createElement('td',null,e.id),React.createElement('td',null,e.employee_name),
          React.createElement('td',{style:{color:gradeColor(e.grade),fontWeight:700}},e.grade),
          React.createElement('td',null,e.claim_type),
          React.createElement('td',{style:{fontWeight:700,color:'var(--green)'}},`€${e.amount}`),
          React.createElement('td',null,e.claim_date),React.createElement('td',null,e.description),
          React.createElement('td',null,React.createElement(SBadge,{s:e.status}))))))));
};

// ══════ Performance ══════
const PerfPage=({t})=>{
  const[reviews,setR]=useState([]);
  useEffect(()=>{API.get('/api/performance').then(setR)},[]);
  return React.createElement('div',{className:'fade'},
    React.createElement('div',{className:'table-wrap'},
      React.createElement('table',null,
        React.createElement('thead',null,React.createElement('tr',null,
          ['编号','员工','职级','周期','类型','总分','评级','状态'].map(h=>React.createElement('th',{key:h},h)))),
        React.createElement('tbody',null,reviews.map(r=>
          React.createElement('tr',{key:r.id},
            React.createElement('td',null,r.id),React.createElement('td',null,r.employee_name),
            React.createElement('td',{style:{color:gradeColor(r.grade),fontWeight:700}},r.grade),
            React.createElement('td',null,r.review_period),React.createElement('td',null,r.review_type),
            React.createElement('td',{style:{fontWeight:700,fontSize:16,color:r.total_score>=90?'var(--green)':r.total_score>=80?'var(--pri)':'var(--yellow)'}},r.total_score),
            React.createElement('td',null,React.createElement('span',{className:`badge-s ${r.rating?.includes('A')?'bg-green':r.rating?.includes('B')?'bg-blue':'bg-yellow'}`},r.rating)),
            React.createElement('td',null,React.createElement(SBadge,{s:r.status}))))))));
};

// ══════ Quotation ══════
const QuotePage=({t})=>{
  const[tpls,setTpls]=useState([]);const[recs,setRecs]=useState([]);const[tab,setTab]=useState('rec');
  useEffect(()=>{API.get('/api/quotation-templates').then(setTpls);API.get('/api/quotations').then(setRecs);},[]);
  return React.createElement('div',{className:'fade'},
    React.createElement('div',{className:'tabs'},
      [['rec','报价记录'],['tpl','报价模板']].map(([k,l])=>React.createElement('div',{key:k,className:`tab ${tab===k?'active':''}`,onClick:()=>setTab(k)},l))),
    tab==='rec'?React.createElement('div',{className:'table-wrap'},
      React.createElement('table',null,
        React.createElement('thead',null,React.createElement('tr',null,
          ['报价号','客户','类型','仓库','人数','单价','总额','审批','客户回复'].map(h=>React.createElement('th',{key:h},h)))),
        React.createElement('tbody',null,recs.map(r=>React.createElement('tr',{key:r.id},
          React.createElement('td',null,r.id),React.createElement('td',null,r.client_name),
          React.createElement('td',null,`${r.biz_type}·${r.service_type}`),
          React.createElement('td',null,r.warehouse_code),React.createElement('td',null,r.headcount),
          React.createElement('td',{style:{color:'var(--green)',fontWeight:700}},`€${r.final_price}`),
          React.createElement('td',{style:{fontWeight:700}},`€${r.total_amount}`),
          React.createElement('td',null,React.createElement(SBadge,{s:r.approve_status})),
          React.createElement('td',null,React.createElement(SBadge,{s:r.client_response})))))))
    :React.createElement('div',{style:{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(300px,1fr))',gap:12}},
      tpls.map(tp=>React.createElement('div',{key:tp.id,className:'card'},
        React.createElement('div',{style:{display:'flex',justifyContent:'space-between'}},
          React.createElement('div',null,
            React.createElement('div',{style:{fontWeight:700,fontSize:15}},tp.name),
            React.createElement('div',{style:{fontSize:12,color:'var(--text2)'}},`${tp.biz_type} · ${tp.service_type}`)),
          React.createElement('div',{style:{textAlign:'right'}},
            React.createElement('div',{style:{fontSize:20,fontWeight:700,color:'var(--green)'}},`€${tp.base_price}`),
            React.createElement('div',{style:{fontSize:11,color:'var(--text3)'}},tp.unit))),
        React.createElement('div',{style:{marginTop:6,fontSize:12,color:'var(--text3)'}},
          `夜班+€${tp.night_surcharge} 周末+€${tp.weekend_surcharge} 节假+€${tp.holiday_surcharge}`)))));
};

// ══════ Files ══════
const FilePage=({t})=>{
  const[files,setF]=useState([]);const[emps,setE]=useState([]);const[selEmp,setSel]=useState('');
  useEffect(()=>{API.get('/api/files').then(setF);API.get('/api/employees').then(setE);},[]);
  const empNames=Object.fromEntries(emps.map(e=>[e.id,e.name]));
  const grouped=files.reduce((a,f)=>{(a[f.employee_id]=a[f.employee_id]||[]).push(f);return a;},{});
  return React.createElement('div',{className:'fade'},
    React.createElement('div',{className:'search-bar'},
      React.createElement('select',{value:selEmp,onChange:e=>setSel(e.target.value),
        style:{padding:'7px 12px',background:'var(--bg)',border:'1px solid var(--border)',borderRadius:6,color:'var(--text)',fontSize:13}},
        React.createElement('option',{value:''},'全部员工'),
        emps.map(e=>React.createElement('option',{key:e.id,value:e.id},`${e.id} ${e.name}`)))),
    Object.entries(grouped).filter(([eid])=>!selEmp||eid===selEmp).map(([eid,fs])=>
      React.createElement('div',{key:eid,className:'card'},
        React.createElement('div',{style:{fontWeight:700,marginBottom:8}},`📁 ${empNames[eid]||eid} 的档案`),
        React.createElement('div',{style:{display:'flex',flexWrap:'wrap',gap:8}},
          fs.map(f=>React.createElement('div',{key:f.id,style:{background:'var(--bg)',padding:'8px 12px',borderRadius:6,fontSize:12,border:'1px solid var(--border)'}},
            React.createElement('div',null,f.confidential?'🔒':'📄',' ',f.file_name),
            React.createElement('div',{style:{color:'var(--text3)',marginTop:2}},`${f.category} · ${f.stage} · ${f.upload_date}`)))))));
};

// ══════ Warehouse Management ══════
const WarehousePage=({t})=>{
  const[whs,setWhs]=useState([]);const[showEdit,setShowEdit]=useState(null);
  useEffect(()=>{API.get('/api/warehouses').then(setWhs);},[]);
  const save=async()=>{
    if(showEdit._isNew){
      const d={...showEdit};delete d._isNew;
      await API.post('/api/warehouses',d);
    }else{
      await API.put(`/api/warehouses/${showEdit.code}`,showEdit);
    }
    showToast('保存成功');setShowEdit(null);
    API.get('/api/warehouses').then(setWhs);
  };
  const coopColors={'自营':'var(--green)','合作派遣':'var(--blue)','外包':'var(--orange)'};
  return React.createElement('div',{className:'fade'},
    React.createElement('div',{className:'search-bar'},
      React.createElement('button',{className:'btn btn-pri',onClick:()=>setShowEdit({_isNew:true,code:'',name:'',address:'',phone:'',
        tax_number:'',contact_person:'',cooperation_mode:'自营',contact_email:'',client_name:'',project_no:'',biz_line:'渊博',note:''})},'新增仓库')),
    React.createElement('div',{className:'table-wrap'},
      React.createElement('table',null,
        React.createElement('thead',null,React.createElement('tr',null,
          ['编码','名称','地址','负责人','电话','税号','合作方式','客户','业务线','操作'].map(h=>React.createElement('th',{key:h},h)))),
        React.createElement('tbody',null,whs.map(w=>React.createElement('tr',{key:w.code},
          React.createElement('td',{style:{fontWeight:700}},w.code),
          React.createElement('td',null,w.name),
          React.createElement('td',null,w.address||'-'),
          React.createElement('td',null,w.contact_person||w.manager||'-'),
          React.createElement('td',null,w.phone||'-'),
          React.createElement('td',{style:{fontSize:11}},w.tax_number||'-'),
          React.createElement('td',null,React.createElement('span',{style:{background:coopColors[w.cooperation_mode]||'var(--text3)',color:'#fff',padding:'2px 8px',borderRadius:4,fontSize:11}},w.cooperation_mode||'自营')),
          React.createElement('td',null,w.client_name||'-'),
          React.createElement('td',null,w.biz_line||'-'),
          React.createElement('td',null,React.createElement('button',{className:'btn btn-sm btn-ghost',onClick:()=>setShowEdit(w)},'编辑'))))))),
    showEdit&&React.createElement('div',{className:'modal-overlay',onClick:()=>setShowEdit(null)},
      React.createElement('div',{className:'modal',onClick:e=>e.stopPropagation()},
        React.createElement('h3',null,showEdit._isNew?'新增仓库':'编辑仓库'),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'仓库编码'),
            React.createElement('input',{value:showEdit.code||'',onChange:e=>setShowEdit({...showEdit,code:e.target.value}),disabled:!showEdit._isNew})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'仓库名称'),
            React.createElement('input',{value:showEdit.name||'',onChange:e=>setShowEdit({...showEdit,name:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'地址'),
            React.createElement('input',{value:showEdit.address||'',onChange:e=>setShowEdit({...showEdit,address:e.target.value})}))),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'负责人'),
            React.createElement('input',{value:showEdit.contact_person||'',onChange:e=>setShowEdit({...showEdit,contact_person:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'电话'),
            React.createElement('input',{value:showEdit.phone||'',onChange:e=>setShowEdit({...showEdit,phone:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'邮箱'),
            React.createElement('input',{value:showEdit.contact_email||'',onChange:e=>setShowEdit({...showEdit,contact_email:e.target.value})}))),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'税号'),
            React.createElement('input',{value:showEdit.tax_number||'',onChange:e=>setShowEdit({...showEdit,tax_number:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'合作方式'),
            React.createElement('select',{value:showEdit.cooperation_mode||'自营',onChange:e=>setShowEdit({...showEdit,cooperation_mode:e.target.value})},
              ['自营','合作派遣','外包'].map(m=>React.createElement('option',{key:m,value:m},m)))),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'业务线'),
            React.createElement('select',{value:showEdit.biz_line||'渊博',onChange:e=>setShowEdit({...showEdit,biz_line:e.target.value})},
              ['渊博','579'].map(b=>React.createElement('option',{key:b,value:b},b))))),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'客户名称'),
            React.createElement('input',{value:showEdit.client_name||'',onChange:e=>setShowEdit({...showEdit,client_name:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'项目编号'),
            React.createElement('input',{value:showEdit.project_no||'',onChange:e=>setShowEdit({...showEdit,project_no:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'备注'),
            React.createElement('input',{value:showEdit.note||'',onChange:e=>setShowEdit({...showEdit,note:e.target.value})}))),
        React.createElement('div',{style:{display:'flex',gap:8,justifyContent:'flex-end',marginTop:16}},
          React.createElement('button',{className:'btn btn-ghost',onClick:()=>setShowEdit(null)},'取消'),
          React.createElement('button',{className:'btn btn-pri',onClick:save},'保存')))));
};

// ══════ Enterprise Documents ══════
const DocsPage=({t})=>{
  const[docs,setDocs]=useState([]);const[whs,setWhs]=useState([]);
  const[selCat,setSelCat]=useState('');const[showEdit,setShowEdit]=useState(null);
  useEffect(()=>{API.get('/api/enterprise-docs').then(setDocs);API.get('/api/warehouses').then(setWhs);},[]);
  const categories=['安全培训','操作SOP','管理制度','通用'];
  const filtered=selCat?docs.filter(d=>d.category===selCat):docs;
  const save=async()=>{
    if(showEdit.id&&!showEdit._isNew){
      await API.put(`/api/enterprise-docs/${showEdit.id}`,showEdit);
    }else{
      const d={...showEdit};delete d._isNew;delete d.id;
      await API.post('/api/enterprise-docs',d);
    }
    showToast('保存成功');setShowEdit(null);
    API.get('/api/enterprise-docs').then(setDocs);
  };
  const catColors={'安全培训':'var(--red)','操作SOP':'var(--blue)','管理制度':'var(--orange)','通用':'var(--green)'};
  return React.createElement('div',{className:'fade'},
    React.createElement('div',{className:'search-bar'},
      React.createElement('select',{value:selCat,onChange:e=>setSelCat(e.target.value),
        style:{padding:'7px 12px',background:'var(--bg)',border:'1px solid var(--border)',borderRadius:6,color:'var(--text)'}},
        React.createElement('option',{value:''},'全部分类'),
        categories.map(c=>React.createElement('option',{key:c,value:c},c))),
      React.createElement('button',{className:'btn btn-pri',onClick:()=>setShowEdit({_isNew:true,title:'',category:'通用',description:'',tags:'',
        warehouse_code:'',send_to:'',status:'已发布',file_name:'',file_url:''})},'新增文档')),
    React.createElement('div',{style:{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(300px,1fr))',gap:12}},
      filtered.map(d=>React.createElement('div',{key:d.id,className:'card',style:{cursor:'pointer'},onClick:()=>setShowEdit(d)},
        React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:8}},
          React.createElement('span',{style:{background:catColors[d.category]||'var(--text3)',color:'#fff',padding:'2px 8px',borderRadius:4,fontSize:11}},d.category),
          React.createElement('span',{style:{fontSize:11,color:d.status==='已发布'?'var(--green)':'var(--text3)'}},d.status)),
        React.createElement('div',{style:{fontWeight:700,fontSize:14,marginBottom:4}},d.title),
        React.createElement('div',{style:{fontSize:12,color:'var(--text2)',marginBottom:6}},d.description||''),
        React.createElement('div',{style:{display:'flex',justifyContent:'space-between',fontSize:11,color:'var(--text3)'}},
          React.createElement('span',null,'📤 ',d.send_to||'全员'),
          React.createElement('span',null,d.warehouse_code?`🏭 ${d.warehouse_code}`:'通用')),
        d.tags&&React.createElement('div',{style:{marginTop:6,display:'flex',flexWrap:'wrap',gap:4}},
          d.tags.split(',').map(tag=>React.createElement('span',{key:tag,style:{background:'var(--bg)',padding:'1px 6px',borderRadius:3,fontSize:10,border:'1px solid var(--border)'}},tag.trim())))))),
    showEdit&&React.createElement('div',{className:'modal-overlay',onClick:()=>setShowEdit(null)},
      React.createElement('div',{className:'modal',onClick:e=>e.stopPropagation()},
        React.createElement('h3',null,showEdit._isNew?'新增企业文档':'编辑企业文档'),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'标题'),
            React.createElement('input',{value:showEdit.title||'',onChange:e=>setShowEdit({...showEdit,title:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'分类'),
            React.createElement('select',{value:showEdit.category||'通用',onChange:e=>setShowEdit({...showEdit,category:e.target.value})},
              categories.map(c=>React.createElement('option',{key:c,value:c},c)))),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'状态'),
            React.createElement('select',{value:showEdit.status||'已发布',onChange:e=>setShowEdit({...showEdit,status:e.target.value})},
              ['已发布','草稿'].map(s=>React.createElement('option',{key:s,value:s},s))))),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field',style:{flex:2}},React.createElement('label',null,'描述'),
            React.createElement('input',{value:showEdit.description||'',onChange:e=>setShowEdit({...showEdit,description:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'标签(逗号分隔)'),
            React.createElement('input',{value:showEdit.tags||'',onChange:e=>setShowEdit({...showEdit,tags:e.target.value})}))),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'适用仓库'),
            React.createElement('select',{value:showEdit.warehouse_code||'',onChange:e=>setShowEdit({...showEdit,warehouse_code:e.target.value})},
              React.createElement('option',{value:''},'全部仓库'),
              whs.map(w=>React.createElement('option',{key:w.code,value:w.code},`${w.code} - ${w.name}`)))),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'发送对象'),
            React.createElement('input',{value:showEdit.send_to||'',onChange:e=>setShowEdit({...showEdit,send_to:e.target.value}),placeholder:'如: 全员、装卸岗、管理层'})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'文件名'),
            React.createElement('input',{value:showEdit.file_name||'',onChange:e=>setShowEdit({...showEdit,file_name:e.target.value})}))),
        React.createElement('div',{style:{display:'flex',gap:8,justifyContent:'flex-end',marginTop:16}},
          React.createElement('button',{className:'btn btn-ghost',onClick:()=>setShowEdit(null)},'取消'),
          React.createElement('button',{className:'btn btn-pri',onClick:save},'保存')))));
};

// ══════ Clock ══════
const ClockPage=({lang,t})=>{
  const[time,setTime]=useState(new Date());
  useEffect(()=>{const t=setInterval(()=>setTime(new Date()),1000);return()=>clearInterval(t)},[]);
  return React.createElement('div',{className:'fade',style:{display:'flex',flexDirection:'column',alignItems:'center',paddingTop:60}},
    React.createElement('div',{style:{fontSize:64,fontWeight:700,fontFamily:'monospace',color:'var(--pri)'}},
      time.toLocaleTimeString(LOCALE_MAP[lang]||'en-US')),
    React.createElement('div',{style:{fontSize:18,color:'var(--text2)',margin:'8px 0 30px'}},
      time.toLocaleDateString(LOCALE_MAP[lang]||'en-US',{weekday:'long',year:'numeric',month:'long',day:'numeric'})),
    React.createElement('button',{className:'btn btn-pri',style:{padding:'16px 48px',fontSize:18,borderRadius:12}},
      `🕐 ${t.clock}`));
};

// ══════ Suppliers Page ══════
const SuppliersPage=({t,user})=>{
  const[sups,setSups]=useState([]);const[showEdit,setShowEdit]=useState(null);
  const[activities,setActivities]=useState(null);const[actTab,setActTab]=useState('workers');
  const isSupplier=user&&user.role==='sup';
  useEffect(()=>{
    if(!isSupplier)API.get('/api/suppliers').then(setSups);
    if(isSupplier)API.get('/api/supplier/worker-activities').then(setActivities);
  },[]);
  const save=async()=>{
    if(showEdit._isNew){
      const d={...showEdit};delete d._isNew;
      await API.post('/api/suppliers',d);
    }else{
      await API.put(`/api/suppliers/${showEdit.id}`,showEdit);
    }
    showToast('保存成功');setShowEdit(null);
    API.get('/api/suppliers').then(setSups);
  };
  // Supplier user view: show worker activities
  if(isSupplier&&activities)return React.createElement('div',{className:'fade'},
    React.createElement('h3',{style:{marginBottom:12}},'供应商工人动态'),
    React.createElement('div',{className:'stats',style:{marginBottom:16}},
      [{n:activities.summary?.total_workers||0,l:'总工人数',c:'var(--pri)'},
       {n:activities.summary?.active_workers||0,l:'在职工人',c:'var(--green)'},
       {n:(activities.summary?.monthly_hours||0).toFixed(1)+'h',l:'本月工时',c:'var(--cyan)'},
       {n:activities.summary?.pending_leave||0,l:'待审批请假',c:'var(--warn)'}
      ].map((s,i)=>React.createElement('div',{key:i,className:'stat'},
        React.createElement('div',{className:'num',style:{color:s.c}},s.n),
        React.createElement('div',{className:'label'},s.l)))),
    activities.summary?.by_warehouse?.length>0&&React.createElement('div',{className:'card',style:{marginBottom:12,padding:12}},
      React.createElement('h4',{style:{marginBottom:8}},'按仓库分布'),
      React.createElement('div',{style:{display:'flex',gap:12,flexWrap:'wrap'}},
        (activities.summary.by_warehouse||[]).map((w,i)=>React.createElement('div',{key:i,className:'badge',
          style:{padding:'4px 12px',background:'var(--bg)',borderRadius:8}},w.primary_wh+': '+w.c+'人')))),
    React.createElement('div',{className:'tabs',style:{marginBottom:12}},
      [['workers','工人列表'],['timesheet','工时记录'],['leave','请假记录']].map(([k,l])=>
        React.createElement('div',{key:k,className:`tab ${actTab===k?'active':''}`,onClick:()=>setActTab(k)},l))),
    actTab==='workers'&&React.createElement('div',{className:'table-wrap'},
      React.createElement('table',null,
        React.createElement('thead',null,React.createElement('tr',null,
          ['编号','姓名','职级','岗位','主仓库','状态'].map(h=>React.createElement('th',{key:h},h)))),
        React.createElement('tbody',null,(activities.workers||[]).map(w=>React.createElement('tr',{key:w.id},
          React.createElement('td',null,w.id),React.createElement('td',{style:{fontWeight:700}},w.name),
          React.createElement('td',{style:{color:gradeColor(w.grade)}},w.grade),
          React.createElement('td',null,w.position||'-'),React.createElement('td',null,w.primary_wh||'-'),
          React.createElement('td',null,React.createElement(SBadge,{s:w.status||'在职'}))))))),
    actTab==='timesheet'&&React.createElement('div',{className:'table-wrap'},
      React.createElement('table',null,
        React.createElement('thead',null,React.createElement('tr',null,
          ['日期','员工','仓库','工时','时薪','状态'].map(h=>React.createElement('th',{key:h},h)))),
        React.createElement('tbody',null,(activities.timesheet||[]).map((r,i)=>React.createElement('tr',{key:i},
          React.createElement('td',null,r.work_date),React.createElement('td',null,r.employee_name||r.employee_id),
          React.createElement('td',null,r.warehouse_code),React.createElement('td',null,(r.hours||0)+'h'),
          React.createElement('td',null,'€'+(r.hourly_pay||0).toFixed(2)),
          React.createElement('td',null,React.createElement(SBadge,{s:r.wh_status||'待审批'}))))))),
    actTab==='leave'&&React.createElement('div',{className:'table-wrap'},
      React.createElement('table',null,
        React.createElement('thead',null,React.createElement('tr',null,
          ['员工','类型','开始','结束','天数','状态'].map(h=>React.createElement('th',{key:h},h)))),
        React.createElement('tbody',null,(activities.leave_requests||[]).map((lr,i)=>React.createElement('tr',{key:i},
          React.createElement('td',null,lr.employee_name||lr.employee_id),React.createElement('td',null,lr.leave_type),
          React.createElement('td',null,lr.start_date),React.createElement('td',null,lr.end_date),
          React.createElement('td',null,lr.days),
          React.createElement('td',null,React.createElement(SBadge,{s:lr.status||'待审批'}))))))));
  // Normal supplier management view
  return React.createElement('div',{className:'fade'},
    React.createElement('div',{className:'search-bar'},
      React.createElement('button',{className:'btn btn-pri',onClick:()=>setShowEdit({_isNew:true,name:'',type:'人力供应商',biz_line:'渊博',contact_name:'',contact_phone:'',contact_email:'',address:'',status:'合作中'})},'新增供应商')),
    React.createElement('div',{className:'table-wrap'},
      React.createElement('table',null,
        React.createElement('thead',null,React.createElement('tr',null,
          ['编号','名称','类型','业务线','联系人','电话','状态','操作'].map(h=>React.createElement('th',{key:h},h)))),
        React.createElement('tbody',null,sups.map(s=>React.createElement('tr',{key:s.id},
          React.createElement('td',null,s.id),React.createElement('td',{style:{fontWeight:700}},s.name),
          React.createElement('td',null,s.type||'-'),React.createElement('td',null,s.biz_line||'-'),
          React.createElement('td',null,s.contact_name||'-'),React.createElement('td',null,s.contact_phone||'-'),
          React.createElement('td',null,React.createElement(SBadge,{s:s.status||'合作中'})),
          React.createElement('td',null,React.createElement('button',{className:'btn btn-sm btn-ghost',onClick:()=>setShowEdit(s)},'编辑'))))))),
    showEdit&&React.createElement('div',{className:'modal-overlay',onClick:()=>setShowEdit(null)},
      React.createElement('div',{className:'modal',onClick:e=>e.stopPropagation()},
        React.createElement('h3',null,showEdit._isNew?'新增供应商':'编辑供应商'),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'名称'),
            React.createElement('input',{value:showEdit.name||'',onChange:e=>setShowEdit({...showEdit,name:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'类型'),
            React.createElement('input',{value:showEdit.type||'',onChange:e=>setShowEdit({...showEdit,type:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'业务线'),
            React.createElement('select',{value:showEdit.biz_line||'渊博',onChange:e=>setShowEdit({...showEdit,biz_line:e.target.value})},
              ['渊博','579'].map(b=>React.createElement('option',{key:b,value:b},b))))),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'联系人'),
            React.createElement('input',{value:showEdit.contact_name||'',onChange:e=>setShowEdit({...showEdit,contact_name:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'电话'),
            React.createElement('input',{value:showEdit.contact_phone||'',onChange:e=>setShowEdit({...showEdit,contact_phone:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'邮箱'),
            React.createElement('input',{value:showEdit.contact_email||'',onChange:e=>setShowEdit({...showEdit,contact_email:e.target.value})}))),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'地址'),
            React.createElement('input',{value:showEdit.address||'',onChange:e=>setShowEdit({...showEdit,address:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'状态'),
            React.createElement('select',{value:showEdit.status||'合作中',onChange:e=>setShowEdit({...showEdit,status:e.target.value})},
              ['合作中','已终止'].map(s=>React.createElement('option',{key:s,value:s},s))))),
        React.createElement('div',{style:{display:'flex',gap:8,justifyContent:'flex-end',marginTop:16}},
          React.createElement('button',{className:'btn btn-ghost',onClick:()=>setShowEdit(null)},'取消'),
          React.createElement('button',{className:'btn btn-pri',onClick:save},'保存')))));
};

// ══════ Container Page ══════
const ContainerPage=({t})=>{
  const[recs,setRecs]=useState([]);const[showEdit,setShowEdit]=useState(null);const[whs,setWhs]=useState([]);
  useEffect(()=>{API.get('/api/containers').then(setRecs);API.get('/api/warehouses').then(setWhs);},[]);
  const save=async()=>{
    if(showEdit._isNew){const d={...showEdit};delete d._isNew;await API.post('/api/containers',d);}
    else{await API.put(`/api/containers/${showEdit.id}`,showEdit);}
    showToast('保存成功');setShowEdit(null);API.get('/api/containers').then(setRecs);
  };
  const handleImport=async(e)=>{
    const file=e.target.files[0];if(!file)return;
    const text=await file.text();
    try{const data=JSON.parse(text);await API.post('/api/import/container_records',{data:Array.isArray(data)?data:data.data||[]});showToast('导入成功');API.get('/api/containers').then(setRecs);}
    catch(err){showToast('导入失败: '+err.message);}
    e.target.value='';
  };
  const downloadTemplate=async()=>{
    try{const tpl=await API.get('/api/template/container_records');
      const blob=new Blob([JSON.stringify({fields:tpl.fields,labels:tpl.labels,data:[tpl.sample]},null,2)],{type:'application/json'});
      const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='container_records_template.json';a.click();
    }catch(err){showToast('下载模版失败');}
  };
  const handleExport=async(fmt)=>{
    if(fmt==='json'){const d=await API.get('/api/export/container_records');const blob=new Blob([JSON.stringify(d,null,2)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='container_records.json';a.click();}
    else{window.open(`/api/export/container_records?fmt=${fmt}&token=${localStorage.getItem('token')}`,'_blank');}
  };
  return React.createElement('div',{className:'fade'},
    React.createElement('div',{className:'search-bar',style:{display:'flex',gap:8,flexWrap:'wrap'}},
      React.createElement('button',{className:'btn btn-pri',onClick:()=>{const now=new Date().toISOString().slice(0,10);setShowEdit({_isNew:true,container_no:'',work_date:now,warehouse_code:'',container_type:'40GP',load_type:'卸柜',dock_no:'',ratio:0,team_no:'',team_size:2,start_time:'08:00',end_time:'09:00',notes:''});}},'新增装卸柜记录'),
      React.createElement('button',{className:'btn btn-ghost',onClick:downloadTemplate},'下载导入模版'),
      React.createElement('label',{className:'btn btn-ghost',style:{cursor:'pointer'}},
        '批量导入',React.createElement('input',{type:'file',accept:'.json',style:{display:'none'},onChange:handleImport})),
      React.createElement('select',{className:'btn btn-ghost',style:{appearance:'auto'},onChange:e=>{if(e.target.value){handleExport(e.target.value);e.target.value='';}}},
        React.createElement('option',{value:''},'导出...'),
        React.createElement('option',{value:'json'},'JSON'),React.createElement('option',{value:'csv'},'CSV'),
        React.createElement('option',{value:'excel'},'Excel'),React.createElement('option',{value:'pdf'},'PDF'))),
    React.createElement('div',{className:'table-wrap'},
      React.createElement('table',null,
        React.createElement('thead',null,React.createElement('tr',null,
          ['编号','柜号','日期','仓库','柜型','类型','垛口','比例','组号','人数','时长(分)','状态','操作'].map(h=>React.createElement('th',{key:h},h)))),
        React.createElement('tbody',null,recs.map(r=>React.createElement('tr',{key:r.id},
          React.createElement('td',null,r.id),React.createElement('td',{style:{fontWeight:700}},r.container_no||'-'),
          React.createElement('td',null,r.work_date||'-'),React.createElement('td',null,r.warehouse_code||'-'),
          React.createElement('td',null,r.container_type||'40GP'),React.createElement('td',null,r.load_type||'卸柜'),
          React.createElement('td',null,r.dock_no||'-'),React.createElement('td',null,r.ratio!=null&&r.ratio!==0?r.ratio:'-'),
          React.createElement('td',null,r.team_no||'-'),React.createElement('td',null,r.team_size||0),
          React.createElement('td',null,r.duration_minutes||0),
          React.createElement('td',null,React.createElement(SBadge,{s:r.wh_status||'待审核'})),
          React.createElement('td',null,React.createElement('button',{className:'btn btn-sm btn-ghost',onClick:()=>setShowEdit(r)},'编辑'))))))),
    showEdit&&React.createElement('div',{className:'modal-overlay',onClick:()=>setShowEdit(null)},
      React.createElement('div',{className:'modal',onClick:e=>e.stopPropagation()},
        React.createElement('h3',null,showEdit._isNew?'新增装卸柜记录':'编辑装卸柜记录'),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'柜号'),
            React.createElement('input',{value:showEdit.container_no||'',onChange:e=>setShowEdit({...showEdit,container_no:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'工作日期'),
            React.createElement('input',{type:'date',value:showEdit.work_date||'',onChange:e=>setShowEdit({...showEdit,work_date:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'仓库'),
            React.createElement('select',{value:showEdit.warehouse_code||'',onChange:e=>setShowEdit({...showEdit,warehouse_code:e.target.value})},
              React.createElement('option',{value:''},'选择仓库'),
              whs.map(w=>React.createElement('option',{key:w.code,value:w.code},`${w.code} ${w.name}`))))),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'柜型'),
            React.createElement('select',{value:showEdit.container_type||'40GP',onChange:e=>setShowEdit({...showEdit,container_type:e.target.value})},
              ['20GP','40GP','45HC'].map(ct=>React.createElement('option',{key:ct,value:ct},ct)))),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'类型'),
            React.createElement('select',{value:showEdit.load_type||'卸柜',onChange:e=>setShowEdit({...showEdit,load_type:e.target.value})},
              ['卸柜','装柜'].map(lt=>React.createElement('option',{key:lt,value:lt},lt)))),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'组号'),
            React.createElement('input',{value:showEdit.team_no||'',onChange:e=>setShowEdit({...showEdit,team_no:e.target.value})}))),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'垛口'),
            React.createElement('input',{value:showEdit.dock_no||'',onChange:e=>setShowEdit({...showEdit,dock_no:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'比例'),
            React.createElement('input',{type:'number',step:'0.01',value:showEdit.ratio||0,onChange:e=>setShowEdit({...showEdit,ratio:parseFloat(e.target.value)||0})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'人数'),
            React.createElement('input',{type:'number',value:showEdit.team_size||0,onChange:e=>setShowEdit({...showEdit,team_size:parseInt(e.target.value)||0})}))),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'开始时间'),
            React.createElement('input',{type:'time',value:showEdit.start_time||'',onChange:e=>setShowEdit({...showEdit,start_time:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'结束时间'),
            React.createElement('input',{type:'time',value:showEdit.end_time||'',onChange:e=>setShowEdit({...showEdit,end_time:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'备注'),
            React.createElement('input',{value:showEdit.notes||'',onChange:e=>setShowEdit({...showEdit,notes:e.target.value})}))),
        React.createElement('div',{style:{display:'flex',gap:8,justifyContent:'flex-end',marginTop:16}},
          React.createElement('button',{className:'btn btn-ghost',onClick:()=>setShowEdit(null)},'取消'),
          React.createElement('button',{className:'btn btn-pri',onClick:save},'保存')))));
};

// ══════ Schedule Page ══════
const SchedulePage=({t})=>{
  const[rows,setRows]=useState([]);const[showEdit,setShowEdit]=useState(null);const[whs,setWhs]=useState([]);const[emps,setEmps]=useState([]);
  useEffect(()=>{API.get('/api/schedules').then(setRows);API.get('/api/warehouses').then(setWhs);API.get('/api/employees').then(setEmps);},[]);
  const save=async()=>{
    if(showEdit._isNew){const d={...showEdit};delete d._isNew;await API.post('/api/schedules',d);}
    else{await API.put(`/api/schedules/${showEdit.id}`,showEdit);}
    showToast('保存成功');setShowEdit(null);API.get('/api/schedules').then(setRows);
  };
  const handleImport=async(e)=>{
    const file=e.target.files[0];if(!file)return;
    const text=await file.text();
    try{const data=JSON.parse(text);await API.post('/api/import/schedules',{data:Array.isArray(data)?data:data.data||[]});showToast('导入成功');API.get('/api/schedules').then(setRows);}
    catch(err){showToast('导入失败: '+err.message);}
    e.target.value='';
  };
  const downloadTemplate=async()=>{
    try{const tpl=await API.get('/api/template/schedules');
      const blob=new Blob([JSON.stringify({fields:tpl.fields,labels:tpl.labels,data:[tpl.sample]},null,2)],{type:'application/json'});
      const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='schedules_template.json';a.click();
    }catch(err){showToast('下载模版失败');}
  };
  const handleExport=async(fmt)=>{
    if(fmt==='json'){const d=await API.get('/api/export/schedules');const blob=new Blob([JSON.stringify(d,null,2)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='schedules.json';a.click();}
    else{window.open(`/api/export/schedules?fmt=${fmt}&token=${localStorage.getItem('token')}`,'_blank');}
  };
  return React.createElement('div',{className:'fade'},
    React.createElement('div',{className:'search-bar',style:{display:'flex',gap:8,flexWrap:'wrap'}},
      React.createElement('button',{className:'btn btn-pri',onClick:()=>{const now=new Date().toISOString().slice(0,10);setShowEdit({_isNew:true,employee_id:'',employee_name:'',warehouse_code:'',work_date:now,shift:'白班',start_time:'08:00',end_time:'17:00',position:'库内',notes:''});}},'新增排班'),
      React.createElement('button',{className:'btn btn-ghost',onClick:downloadTemplate},'下载导入模版'),
      React.createElement('label',{className:'btn btn-ghost',style:{cursor:'pointer'}},
        '批量导入',React.createElement('input',{type:'file',accept:'.json',style:{display:'none'},onChange:handleImport})),
      React.createElement('select',{className:'btn btn-ghost',style:{appearance:'auto'},onChange:e=>{if(e.target.value){handleExport(e.target.value);e.target.value='';}}},
        React.createElement('option',{value:''},'导出...'),
        React.createElement('option',{value:'json'},'JSON'),React.createElement('option',{value:'csv'},'CSV'),
        React.createElement('option',{value:'excel'},'Excel'),React.createElement('option',{value:'pdf'},'PDF'))),
    React.createElement('div',{className:'table-wrap'},
      React.createElement('table',null,
        React.createElement('thead',null,React.createElement('tr',null,
          ['编号','员工','仓库','日期','班次','开始','结束','岗位','状态','操作'].map(h=>React.createElement('th',{key:h},h)))),
        React.createElement('tbody',null,rows.map(r=>React.createElement('tr',{key:r.id},
          React.createElement('td',null,r.id),React.createElement('td',{style:{fontWeight:700}},r.employee_name||'-'),
          React.createElement('td',null,r.warehouse_code||'-'),React.createElement('td',null,r.work_date||'-'),
          React.createElement('td',null,r.shift||'白班'),React.createElement('td',null,r.start_time||'-'),
          React.createElement('td',null,r.end_time||'-'),React.createElement('td',null,r.position||'-'),
          React.createElement('td',null,React.createElement(SBadge,{s:r.status||'已排班'})),
          React.createElement('td',null,React.createElement('button',{className:'btn btn-sm btn-ghost',onClick:()=>setShowEdit(r)},'编辑'))))))),
    showEdit&&React.createElement('div',{className:'modal-overlay',onClick:()=>setShowEdit(null)},
      React.createElement('div',{className:'modal',onClick:e=>e.stopPropagation()},
        React.createElement('h3',null,showEdit._isNew?'新增排班':'编辑排班'),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'员工'),
            React.createElement('select',{value:showEdit.employee_id||'',onChange:e=>{const emp=emps.find(x=>x.id===e.target.value);setShowEdit({...showEdit,employee_id:e.target.value,employee_name:emp?emp.name:''});}},
              React.createElement('option',{value:''},'选择员工'),
              emps.map(em=>React.createElement('option',{key:em.id,value:em.id},`${em.id} ${em.name}`)))),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'仓库'),
            React.createElement('select',{value:showEdit.warehouse_code||'',onChange:e=>setShowEdit({...showEdit,warehouse_code:e.target.value})},
              React.createElement('option',{value:''},'选择仓库'),
              whs.map(w=>React.createElement('option',{key:w.code,value:w.code},`${w.code} ${w.name}`)))),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'工作日期'),
            React.createElement('input',{type:'date',value:showEdit.work_date||'',onChange:e=>setShowEdit({...showEdit,work_date:e.target.value})}))),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'班次'),
            React.createElement('select',{value:showEdit.shift||'白班',onChange:e=>setShowEdit({...showEdit,shift:e.target.value})},
              ['白班','夜班','中班'].map(s=>React.createElement('option',{key:s,value:s},s)))),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'开始时间'),
            React.createElement('input',{type:'time',value:showEdit.start_time||'',onChange:e=>setShowEdit({...showEdit,start_time:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'结束时间'),
            React.createElement('input',{type:'time',value:showEdit.end_time||'',onChange:e=>setShowEdit({...showEdit,end_time:e.target.value})}))),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'岗位'),
            React.createElement('input',{value:showEdit.position||'',onChange:e=>setShowEdit({...showEdit,position:e.target.value})})),
          React.createElement('div',{className:'form-field',style:{flex:2}},React.createElement('label',null,'备注'),
            React.createElement('input',{value:showEdit.notes||'',onChange:e=>setShowEdit({...showEdit,notes:e.target.value})}))),
        React.createElement('div',{style:{display:'flex',gap:8,justifyContent:'flex-end',marginTop:16}},
          React.createElement('button',{className:'btn btn-ghost',onClick:()=>setShowEdit(null)},'取消'),
          React.createElement('button',{className:'btn btn-pri',onClick:save},'保存')))));
};

// ══════ Dispatch Page ══════
const DispatchPage=({t})=>{
  const[rows,setRows]=useState([]);const[showEdit,setShowEdit]=useState(null);const[whs,setWhs]=useState([]);
  useEffect(()=>{API.get('/api/dispatch').then(setRows);API.get('/api/warehouses').then(setWhs);},[]);
  const save=async()=>{
    if(showEdit._isNew){const d={...showEdit};delete d._isNew;await API.post('/api/dispatch',d);}
    else{await API.put(`/api/dispatch/${showEdit.id}`,showEdit);}
    showToast('保存成功');setShowEdit(null);API.get('/api/dispatch').then(setRows);
  };
  const handleImport=async(e)=>{
    const file=e.target.files[0];if(!file)return;
    const text=await file.text();
    try{const data=JSON.parse(text);await API.post('/api/import/dispatch_needs',{data:Array.isArray(data)?data:data.data||[]});showToast('导入成功');API.get('/api/dispatch').then(setRows);}
    catch(err){showToast('导入失败: '+err.message);}
    e.target.value='';
  };
  const downloadTemplate=async()=>{
    try{const tpl=await API.get('/api/template/dispatch_needs');
      const blob=new Blob([JSON.stringify({fields:tpl.fields,labels:tpl.labels,data:[tpl.sample]},null,2)],{type:'application/json'});
      const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='dispatch_needs_template.json';a.click();
    }catch(err){showToast('下载模版失败');}
  };
  const handleExport=async(fmt)=>{
    if(fmt==='json'){const d=await API.get('/api/export/dispatch_needs');const blob=new Blob([JSON.stringify(d,null,2)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='dispatch_needs.json';a.click();}
    else{window.open(`/api/export/dispatch_needs?fmt=${fmt}&token=${localStorage.getItem('token')}`,'_blank');}
  };
  return React.createElement('div',{className:'fade'},
    React.createElement('div',{className:'search-bar',style:{display:'flex',gap:8,flexWrap:'wrap'}},
      React.createElement('button',{className:'btn btn-pri',onClick:()=>{const now=new Date().toISOString().slice(0,10);setShowEdit({_isNew:true,warehouse_code:'',position:'库内',headcount:1,start_date:now,end_date:'',shift:'白班',client_rate:0,priority:'中',notes:''});}},'新增派遣需求'),
      React.createElement('button',{className:'btn btn-ghost',onClick:downloadTemplate},'下载导入模版'),
      React.createElement('label',{className:'btn btn-ghost',style:{cursor:'pointer'}},
        '批量导入',React.createElement('input',{type:'file',accept:'.json',style:{display:'none'},onChange:handleImport})),
      React.createElement('select',{className:'btn btn-ghost',style:{appearance:'auto'},onChange:e=>{if(e.target.value){handleExport(e.target.value);e.target.value='';}}},
        React.createElement('option',{value:''},'导出...'),
        React.createElement('option',{value:'json'},'JSON'),React.createElement('option',{value:'csv'},'CSV'),
        React.createElement('option',{value:'excel'},'Excel'),React.createElement('option',{value:'pdf'},'PDF'))),
    React.createElement('div',{className:'table-wrap'},
      React.createElement('table',null,
        React.createElement('thead',null,React.createElement('tr',null,
          ['编号','仓库','岗位','需求人数','已匹配','开始','结束','优先级','状态','操作'].map(h=>React.createElement('th',{key:h},h)))),
        React.createElement('tbody',null,rows.map(r=>React.createElement('tr',{key:r.id},
          React.createElement('td',null,r.id),React.createElement('td',{style:{fontWeight:700}},r.warehouse_code||'-'),
          React.createElement('td',null,r.position||'-'),React.createElement('td',null,r.headcount||0),
          React.createElement('td',null,r.matched_count||0),React.createElement('td',null,r.start_date||'-'),
          React.createElement('td',null,r.end_date||'-'),
          React.createElement('td',null,React.createElement('span',{style:{color:r.priority==='高'?'var(--red)':r.priority==='中'?'var(--yellow)':'var(--text2)',fontWeight:700}},r.priority||'中')),
          React.createElement('td',null,React.createElement(SBadge,{s:r.status||'待处理'})),
          React.createElement('td',null,React.createElement('button',{className:'btn btn-sm btn-ghost',onClick:()=>setShowEdit(r)},'编辑'))))))),
    showEdit&&React.createElement('div',{className:'modal-overlay',onClick:()=>setShowEdit(null)},
      React.createElement('div',{className:'modal',onClick:e=>e.stopPropagation()},
        React.createElement('h3',null,showEdit._isNew?'新增派遣需求':'编辑派遣需求'),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'仓库'),
            React.createElement('select',{value:showEdit.warehouse_code||'',onChange:e=>setShowEdit({...showEdit,warehouse_code:e.target.value})},
              React.createElement('option',{value:''},'选择仓库'),
              whs.map(w=>React.createElement('option',{key:w.code,value:w.code},`${w.code} ${w.name}`)))),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'岗位'),
            React.createElement('input',{value:showEdit.position||'',onChange:e=>setShowEdit({...showEdit,position:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'需求人数'),
            React.createElement('input',{type:'number',value:showEdit.headcount||0,onChange:e=>setShowEdit({...showEdit,headcount:parseInt(e.target.value)||0})}))),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'开始日期'),
            React.createElement('input',{type:'date',value:showEdit.start_date||'',onChange:e=>setShowEdit({...showEdit,start_date:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'结束日期'),
            React.createElement('input',{type:'date',value:showEdit.end_date||'',onChange:e=>setShowEdit({...showEdit,end_date:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'班次'),
            React.createElement('select',{value:showEdit.shift||'白班',onChange:e=>setShowEdit({...showEdit,shift:e.target.value})},
              ['白班','夜班','中班'].map(s=>React.createElement('option',{key:s,value:s},s))))),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'客户费率'),
            React.createElement('input',{type:'number',step:'0.01',value:showEdit.client_rate||0,onChange:e=>setShowEdit({...showEdit,client_rate:parseFloat(e.target.value)||0})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'优先级'),
            React.createElement('select',{value:showEdit.priority||'中',onChange:e=>setShowEdit({...showEdit,priority:e.target.value})},
              ['低','中','高'].map(p=>React.createElement('option',{key:p,value:p},p)))),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,'备注'),
            React.createElement('input',{value:showEdit.notes||'',onChange:e=>setShowEdit({...showEdit,notes:e.target.value})}))),
        React.createElement('div',{style:{display:'flex',gap:8,justifyContent:'flex-end',marginTop:16}},
          React.createElement('button',{className:'btn btn-ghost',onClick:()=>setShowEdit(null)},'取消'),
          React.createElement('button',{className:'btn btn-pri',onClick:save},'保存')))));
};

// ══════ Admin (Permission Management) Page ══════
const AdminPage=({t,user})=>{
  const[perms,setPerms]=useState([]);const[roles,setRoles]=useState([]);
  const[selRole,setSelRole]=useState('');const[saving,setSaving]=useState(false);
  const PERM_KEYS=['can_view','can_create','can_edit','can_delete','can_export','can_approve','can_import'];
  const PERM_LABELS=['查看','新建','编辑','删除','导出','审批','导入'];
  const SCOPE_OPTIONS=[
    {value:'all',label:'全部数据'},
    {value:'own_warehouse',label:'本仓库'},
    {value:'own_department',label:'本部门'},
    {value:'own_supplier',label:'本供应商'},
    {value:'self_only',label:'仅自己'}
  ];
  useEffect(()=>{
    API.get('/api/roles').then(r=>{setRoles(r);if(r.length)setSelRole(r[0].role)});
    API.get('/api/permissions').then(setPerms);
  },[]);
  const rolePerms=perms.filter(p=>p.role===selRole);
  const toggle=async(mod,key)=>{
    const p=rolePerms.find(r=>r.module===mod);
    if(!p)return;
    const nv={...p,[key]:p[key]?0:1};
    setSaving(true);
    try{
      await API.post('/api/permissions/update',{role:selRole,module:mod,...nv});
      const updated=await API.get('/api/permissions');
      setPerms(updated);showToast('权限已更新');
    }catch(e){showToast('更新失败: '+(e.message||''));}
    setSaving(false);
  };
  const changeScope=async(mod,newScope)=>{
    const p=rolePerms.find(r=>r.module===mod);
    if(!p)return;
    setSaving(true);
    try{
      await API.post('/api/permissions/update',{role:selRole,module:mod,...p,data_scope:newScope});
      const updated=await API.get('/api/permissions');
      setPerms(updated);showToast('数据范围已更新');
    }catch(e){showToast('更新失败: '+(e.message||''));}
    setSaving(false);
  };
  return React.createElement('div',{className:'fade'},
    React.createElement('div',{className:'tabs',style:{marginBottom:12}},
      roles.map(r=>React.createElement('div',{key:r.role,className:`tab ${selRole===r.role?'active':''}`,
        onClick:()=>setSelRole(r.role)},r.label+' ('+r.role+')'))),
    React.createElement('div',{style:{fontSize:12,color:'var(--text3)',marginBottom:8}},
      selRole==='admin'?'⚡ 管理员拥有上帝视角 - 所有权限自动开启，无需手动配置':
      '点击单元格切换权限 | 数据范围: 控制该角色可访问的数据范围(职级/部门/仓库/供应商)'),
    React.createElement('div',{className:'table-wrap'},
      React.createElement('table',null,
        React.createElement('thead',null,React.createElement('tr',null,
          React.createElement('th',null,'模块'),
          PERM_LABELS.map(l=>React.createElement('th',{key:l,style:{textAlign:'center'}},l)),
          React.createElement('th',{style:{textAlign:'center',minWidth:100}},'数据范围'))),
        React.createElement('tbody',null,rolePerms.map(p=>React.createElement('tr',{key:p.module},
          React.createElement('td',{style:{fontWeight:600}},t[p.module]||p.module),
          PERM_KEYS.map((k,i)=>React.createElement('td',{key:k,style:{textAlign:'center',cursor:selRole==='admin'?'default':'pointer',
            background:p[k]?'rgba(34,197,94,0.1)':'transparent'},
            onClick:()=>selRole!=='admin'&&toggle(p.module,k)},
            React.createElement('span',{style:{fontSize:16}},p[k]?'✅':'❌'))),
          React.createElement('td',{style:{textAlign:'center'}},
            selRole==='admin'?React.createElement('span',{style:{fontSize:11,color:'var(--text3)'}},'全部'):
            React.createElement('select',{value:p.data_scope||'all',style:{fontSize:11,padding:'2px 4px',borderRadius:4,border:'1px solid var(--border)'},
              onChange:e=>changeScope(p.module,e.target.value)},
              SCOPE_OPTIONS.map(o=>React.createElement('option',{key:o.value,value:o.value},o.label))))))))));
};

// ══════ Payroll Preview (发薪预览) ══════
const PayrollPreviewPage=({t})=>{
  const[month,setMonth]=useState(new Date().toISOString().slice(0,7));
  const[preview,setPreview]=useState(null);const[loading,setLoading]=useState(false);
  const STEPS=['leader','wh_manager','regional_manager','finance'];
  const STEP_LABELS={leader:'班组长',wh_manager:'驻仓经理',regional_manager:'区域经理',finance:'财务总监'};
  const load=()=>{setLoading(true);API.get(`/api/payroll-preview?month=${month}`).then(r=>{setPreview(r);setLoading(false)})};
  useEffect(load,[month]);
  const genPayslips=()=>{API.post('/api/payslips/generate',{month}).then(r=>{toast(`已生成 ${r.count} 条工资条`);load()})};
  const approveStep=(step)=>{API.post('/api/payroll-confirmations',{month,step}).then(()=>{toast(`${STEP_LABELS[step]}已审批`);load()})};
  const getStepStatus=(step)=>{const c=preview?.confirmations?.find(c=>c.step===step);return c?c.status:'待审批'};
  return React.createElement('div',{className:'fade'},
    React.createElement('div',{className:'flex',style:{justifyContent:'space-between',alignItems:'center',marginBottom:16}},
      React.createElement('h3',null,'发薪预览 - ',month),
      React.createElement('div',{style:{display:'flex',gap:8,alignItems:'center'}},
        React.createElement('input',{type:'month',className:'input',value:month,onChange:e=>setMonth(e.target.value),style:{width:160}}),
        React.createElement('button',{className:'btn',onClick:genPayslips},'生成工资条'))),
    React.createElement('div',{className:'card',style:{marginBottom:16}},
      React.createElement('h4',{style:{marginBottom:12}},'审批流程'),
      React.createElement('div',{style:{display:'flex',gap:12,flexWrap:'wrap'}},
        STEPS.map((step,i)=>{
          const st=getStepStatus(step);
          return React.createElement('div',{key:step,style:{flex:1,minWidth:160,padding:12,borderRadius:8,textAlign:'center',
            background:st==='已审批'?'rgba(34,197,94,.1)':'var(--bg)'}},
            React.createElement('div',{style:{fontSize:13,fontWeight:600}},STEP_LABELS[step]),
            React.createElement('div',{style:{margin:'8px 0'}},React.createElement(SBadge,{s:st})),
            st!=='已审批'&&React.createElement('button',{className:'btn-sm',onClick:()=>approveStep(step)},
              i<STEPS.length-1?'审批':'最终确认'))}))),
    preview&&React.createElement('div',{className:'stats',style:{marginBottom:16}},
      [{n:preview.total_count,l:'总人数',c:'var(--pri)'},
       {n:`€${preview.total_gross?.toFixed(2)}`,l:'总应发',c:'var(--green)'},
       {n:`€${preview.total_net?.toFixed(2)}`,l:'总实发',c:'var(--cyan)'}
      ].map((s,i)=>React.createElement('div',{key:i,className:'stat'},
        React.createElement('div',{className:'num',style:{color:s.c}},s.n),
        React.createElement('div',{className:'label'},s.l)))),
    loading?React.createElement('div',{className:'empty'},'加载中...'):
    preview&&React.createElement('div',{className:'table-wrap'},
      React.createElement('table',null,
        React.createElement('thead',null,React.createElement('tr',null,
          ['员工','职级','主仓库','出勤天数','总工时','时薪合计','计件合计','绩效','其他','应发','社保','税费','实发'].map(h=>React.createElement('th',{key:h},h)))),
        React.createElement('tbody',null,(preview.employees||[]).map((r,i)=>React.createElement('tr',{key:i},
          React.createElement('td',null,r.name),
          React.createElement('td',{style:{color:gradeColor(r.grade)}},r.grade),
          React.createElement('td',null,r.primary_wh),
          React.createElement('td',null,r.work_days),
          React.createElement('td',null,r.total_hours?.toFixed(1)+'h'),
          React.createElement('td',null,`€${r.total_hourly?.toFixed(2)}`),
          React.createElement('td',null,`€${r.total_piece?.toFixed(2)}`),
          React.createElement('td',null,`€${r.total_perf?.toFixed(2)}`),
          React.createElement('td',null,`€${r.total_other?.toFixed(2)}`),
          React.createElement('td',{style:{color:'var(--green)',fontWeight:600}},`€${r.gross_pay?.toFixed(2)}`),
          React.createElement('td',null,`-€${r.total_ssi?.toFixed(2)}`),
          React.createElement('td',null,`-€${r.total_tax?.toFixed(2)}`),
          React.createElement('td',{style:{fontWeight:700,color:'var(--green)'}},`€${r.net_pay?.toFixed(2)}`)))))));
};

// ══════ Org Chart (组织架构图) ══════
const OrgChartPage=({t,lang})=>{
  const[data,setData]=useState(null);const[view,setView]=useState('hierarchy');
  useEffect(()=>{API.get('/api/org-chart').then(setData)},[]);
  if(!data)return React.createElement('div',{className:'empty'},'加载中...');
  const isDE=lang==='de';
  return React.createElement('div',{className:'fade'},
    React.createElement('div',{className:'tabs'},
      [['hierarchy',isDE?'Hierarchie':'层级视图'],['warehouse',isDE?'Nach Lager':'按仓库']].map(([k,l])=>
        React.createElement('div',{key:k,className:`tab ${view===k?'active':''}`,onClick:()=>setView(k)},l))),
    React.createElement('div',{className:'stat',style:{textAlign:'center',marginBottom:16}},
      React.createElement('div',{className:'num'},data.total),
      React.createElement('div',{className:'label'},isDE?'Aktive Mitarbeiter':'在职员工总数')),
    view==='hierarchy'?React.createElement('div',null,
      data.levels.map((lv,i)=>React.createElement('div',{key:i,className:'card',style:{marginLeft:i*16,borderLeft:`3px solid ${gradeColor(lv.grade.split('/')[0])}`}},
        React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:8}},
          React.createElement('div',null,
            React.createElement('span',{style:{fontSize:16,fontWeight:700,color:gradeColor(lv.grade.split('/')[0])}},lv.grade),
            React.createElement('span',{style:{marginLeft:8,fontSize:14}},lv.title)),
          React.createElement('span',{className:'badge-s bg-blue'},lv.employees.length+(isDE?' Personen':'人'))),
        lv.employees.length>0&&React.createElement('div',{style:{display:'flex',flexWrap:'wrap',gap:6}},
          lv.employees.map(e=>React.createElement('div',{key:e.id,style:{padding:'4px 10px',borderRadius:6,background:'var(--bg)',fontSize:12,
            border:'1px solid var(--border)'}},
            React.createElement('b',null,e.name),' ',
            React.createElement('span',{style:{color:'var(--text3)'}},e.primary_wh||'')))))))
    :React.createElement('div',{style:{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(300px,1fr))',gap:12}},
      data.by_warehouse.map(wh=>React.createElement('div',{key:wh.code,className:'card'},
        React.createElement('div',{style:{display:'flex',justifyContent:'space-between',marginBottom:10}},
          React.createElement('div',null,
            React.createElement('span',{style:{fontSize:16,fontWeight:700}},wh.name),
            React.createElement('span',{style:{marginLeft:6,fontSize:12,color:'var(--text3)'}},wh.code)),
          React.createElement('span',{className:'badge-s bg-blue'},wh.employees.length+(isDE?' MA':'人'))),
        wh.employees.map(e=>React.createElement('div',{key:e.id,style:{display:'flex',alignItems:'center',gap:8,padding:'4px 0',borderBottom:'1px solid var(--border)'}},
          React.createElement('span',{style:{color:gradeColor(e.grade),fontWeight:700,width:28}},e.grade),
          React.createElement('span',{style:{fontWeight:500}},e.name),
          React.createElement('span',{style:{fontSize:11,color:'var(--text3)',marginLeft:'auto'}},e.grade_title)))))));
};

// ══════ Safety Incidents (安全事件与投诉) ══════
const SafetyPage=({t,lang})=>{
  const[incidents,setIncidents]=useState([]);const[showEdit,setShowEdit]=useState(null);
  const load=()=>API.get('/api/safety-incidents').then(setIncidents);
  useEffect(load,[]);
  const isDE=lang==='de';
  const save=async()=>{
    if(showEdit._isNew){await API.post('/api/safety-incidents',showEdit);}
    else{await API.put(`/api/safety-incidents/${showEdit.id}`,showEdit);}
    showToast(isDE?'Gespeichert':'已保存');setShowEdit(null);load();
  };
  return React.createElement('div',{className:'fade'},
    React.createElement('div',{className:'search-bar'},
      React.createElement('button',{className:'btn btn-pri',onClick:()=>setShowEdit({_isNew:true,incident_type:'安全事件',severity:'一般',status:'待处理',incident_date:new Date().toISOString().slice(0,10)})},
        '+ '+(isDE?'Neuer Vorfall':'新增事件'))),
    React.createElement('div',{className:'stats'},
      [{n:incidents.length,l:isDE?'Gesamt':'总事件',c:'var(--pri)'},
       {n:incidents.filter(i=>i.status==='待处理').length,l:isDE?'Offen':'待处理',c:'var(--yellow)'},
       {n:incidents.filter(i=>i.status==='已解决').length,l:isDE?'Gelöst':'已解决',c:'var(--green)'},
       {n:incidents.filter(i=>i.severity==='严重').length,l:isDE?'Schwer':'严重',c:'var(--red)'}
      ].map((s,i)=>React.createElement('div',{key:i,className:'stat'},
        React.createElement('div',{className:'num',style:{color:s.c}},s.n),
        React.createElement('div',{className:'label'},s.l)))),
    React.createElement('div',{className:'table-wrap'},
      React.createElement('table',null,
        React.createElement('thead',null,React.createElement('tr',null,
          [isDE?'ID':'编号',isDE?'Typ':'类型',isDE?'Schwere':'严重度',isDE?'Lager':'仓库',
           isDE?'Datum':'日期',isDE?'Beschreibung':'描述',isDE?'Status':'状态',isDE?'Aktion':'操作'].map(h=>React.createElement('th',{key:h},h)))),
        React.createElement('tbody',null,incidents.map(r=>React.createElement('tr',{key:r.id},
          React.createElement('td',null,r.id),
          React.createElement('td',null,React.createElement(SBadge,{s:r.incident_type})),
          React.createElement('td',null,React.createElement('span',{style:{color:r.severity==='严重'?'var(--red)':r.severity==='重要'?'var(--orange)':'var(--text2)',fontWeight:600}},r.severity)),
          React.createElement('td',null,r.warehouse_code),
          React.createElement('td',null,r.incident_date),
          React.createElement('td',{style:{maxWidth:200,overflow:'hidden',textOverflow:'ellipsis'}},r.description),
          React.createElement('td',null,React.createElement(SBadge,{s:r.status})),
          React.createElement('td',null,React.createElement('button',{className:'btn btn-sm btn-ghost',onClick:()=>setShowEdit(r)},isDE?'Bearbeiten':'编辑'))))))),
    showEdit&&React.createElement('div',{className:'modal-overlay',onClick:()=>setShowEdit(null)},
      React.createElement('div',{className:'modal',onClick:e=>e.stopPropagation()},
        React.createElement('h3',null,showEdit._isNew?(isDE?'Neuer Vorfall':'新增安全事件'):(isDE?'Vorfall bearbeiten':'编辑安全事件')),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,isDE?'Typ':'类型'),
            React.createElement('select',{value:showEdit.incident_type||'安全事件',onChange:e=>setShowEdit({...showEdit,incident_type:e.target.value})},
              ['安全事件','客户投诉','设备故障','人员伤害','违规操作'].map(t=>React.createElement('option',{key:t,value:t},t)))),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,isDE?'Schweregrad':'严重度'),
            React.createElement('select',{value:showEdit.severity||'一般',onChange:e=>setShowEdit({...showEdit,severity:e.target.value})},
              ['一般','重要','严重'].map(s=>React.createElement('option',{key:s,value:s},s)))),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,isDE?'Lager':'仓库'),
            React.createElement('input',{value:showEdit.warehouse_code||'',onChange:e=>setShowEdit({...showEdit,warehouse_code:e.target.value})}))),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,isDE?'Datum':'事件日期'),
            React.createElement('input',{type:'date',value:showEdit.incident_date||'',onChange:e=>setShowEdit({...showEdit,incident_date:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,isDE?'Beteiligte':'涉及人员'),
            React.createElement('input',{value:showEdit.involved_employees||'',onChange:e=>setShowEdit({...showEdit,involved_employees:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,isDE?'Status':'状态'),
            React.createElement('select',{value:showEdit.status||'待处理',onChange:e=>setShowEdit({...showEdit,status:e.target.value})},
              ['待处理','处理中','已解决','已关闭'].map(s=>React.createElement('option',{key:s,value:s},s))))),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field',style:{flex:2}},React.createElement('label',null,isDE?'Beschreibung':'事件描述'),
            React.createElement('textarea',{value:showEdit.description||'',onChange:e=>setShowEdit({...showEdit,description:e.target.value})}))),
        React.createElement('div',{className:'form-row'},
          React.createElement('div',{className:'form-field'},React.createElement('label',null,isDE?'Ursache':'原因分析'),
            React.createElement('textarea',{value:showEdit.root_cause||'',onChange:e=>setShowEdit({...showEdit,root_cause:e.target.value})})),
          React.createElement('div',{className:'form-field'},React.createElement('label',null,isDE?'Maßnahme':'纠正措施'),
            React.createElement('textarea',{value:showEdit.corrective_action||'',onChange:e=>setShowEdit({...showEdit,corrective_action:e.target.value})}))),
        React.createElement('div',{style:{display:'flex',gap:8,justifyContent:'flex-end',marginTop:16}},
          React.createElement('button',{className:'btn btn-ghost',onClick:()=>setShowEdit(null)},isDE?'Abbrechen':'取消'),
          React.createElement('button',{className:'btn btn-pri',onClick:save},isDE?'Speichern':'保存')))));
};

// ══════ Employee Registration (新员工自助申报) ══════
const RegisterPage=({t,lang})=>{
  const[form,setForm]=useState({nationality:'',gender:'男',tax_class:'1',source:'自有',tax_mode:'我方报税'});
  const[result,setResult]=useState(null);const[loading,setLoading]=useState(false);
  const isDE=lang==='de';
  const F=(label_zh,label_de,field,type,opts)=>{
    const label=isDE?label_de:label_zh;
    if(type==='select')return React.createElement('div',{className:'form-field'},React.createElement('label',null,label),
      React.createElement('select',{value:form[field]||'',onChange:e=>setForm({...form,[field]:e.target.value})},
        opts.map(o=>React.createElement('option',{key:o,value:o},o))));
    return React.createElement('div',{className:'form-field'},React.createElement('label',null,label),
      React.createElement('input',{type:type||'text',value:form[field]||'',onChange:e=>setForm({...form,[field]:e.target.value})}));
  };
  const submit=async()=>{
    if(!form.name&&!form.family_name){showToast(isDE?'Name erforderlich':'请填写姓名','error');return;}
    setLoading(true);
    try{
      const r=await API.post('/api/employee-register',form);
      if(r?.ok){setResult(r);showToast(isDE?'Erfolgreich registriert':'注册成功');}
      else showToast(r?.detail||'失败','error');
    }catch(e){showToast(e.message,'error');}
    setLoading(false);
  };
  if(result)return React.createElement('div',{className:'fade'},
    React.createElement('div',{className:'card',style:{textAlign:'center',padding:40}},
      React.createElement('div',{style:{fontSize:48,marginBottom:16}},'✅'),
      React.createElement('h2',null,isDE?'Registrierung erfolgreich!':'注册成功！'),
      React.createElement('div',{style:{fontSize:18,color:'var(--pri)',fontWeight:700,margin:'12px 0'}},
        (isDE?'Mitarbeiter-ID: ':'员工编号: ')+result.id),
      React.createElement('div',{style:{color:'var(--text2)'}},result.message),
      React.createElement('button',{className:'btn btn-pri',style:{marginTop:20},onClick:()=>{setResult(null);setForm({nationality:'',gender:'男',tax_class:'1',source:'自有',tax_mode:'我方报税'})}},
        isDE?'Neue Registrierung':'继续注册')));
  return React.createElement('div',{className:'fade'},
    React.createElement('div',{className:'card'},
      React.createElement('h3',{style:{marginBottom:16}},isDE?'Neuer Mitarbeiter — Selbstregistrierung':'新员工申报表格'),
      React.createElement('div',{style:{fontSize:12,color:'var(--text3)',marginBottom:12}},
        isDE?'Bitte füllen Sie alle erforderlichen Felder aus':'请填写以下信息，系统将自动生成员工档案'),
      React.createElement('div',{style:{fontSize:12,color:'var(--cyan)',marginBottom:12}},'基本信息 / Grunddaten'),
      React.createElement('div',{className:'form-row'},F('姓名','Name *','name'),F('姓','Familienname','family_name'),F('名','Vorname','given_name')),
      React.createElement('div',{className:'form-row'},F('性别','Geschlecht','gender','select',['男','女']),F('生日','Geburtsdatum','birth_date','date'),
        F('国籍','Staatsangehörigkeit','nationality'),F('婚姻状况','Familienstand','marital_status','select',['','未婚','已婚','离异','丧偶'])),
      React.createElement('div',{className:'form-row'},F('地址','Adresse','address'),F('电话','Telefon','phone'),F('邮箱','E-Mail','email')),
      React.createElement('div',{style:{fontSize:12,color:'var(--cyan)',marginTop:12,marginBottom:8}},'税务与保险 / Steuer & Versicherung'),
      React.createElement('div',{className:'form-row'},F('社保号','Sozialvers.-Nr.','ssn'),F('税号','Steuer-Nr.','tax_no'),
        F('税号ID','Steuer-ID','tax_id'),F('税级','Steuerklasse','tax_class','select',['1','2','3','4','5','6'])),
      React.createElement('div',{className:'form-row'},F('医疗保险','Krankenversicherung','health_insurance'),
        F('银行账号(IBAN)','IBAN','iban'),F('报税模式','Steuermodus','tax_mode','select',['我方报税','供应商报税','自行报税'])),
      React.createElement('div',{style:{fontSize:12,color:'var(--cyan)',marginTop:12,marginBottom:8}},'工作信息 / Arbeitsdaten'),
      React.createElement('div',{className:'form-row'},F('每周工时','Wochenstunden','work_hours_per_week','number'),
        F('时薪(€)','Stundenlohn (€)','hourly_rate','number'),F('来源','Herkunft','source','select',['自有','供应商']),
        F('供应商','Lieferant','supplier_id')),
      React.createElement('div',{style:{display:'flex',justifyContent:'flex-end',marginTop:16}},
        React.createElement('button',{className:'btn btn-pri',style:{minWidth:160},onClick:submit,disabled:loading},
          loading?'...':(isDE?'Registrieren':'提交申报')))));
};

// ══════ Compliance Check (合规检查) ══════
const CompliancePage=({t,lang})=>{
  const[data,setData]=useState(null);const[month,setMonth]=useState(new Date().toISOString().slice(0,7));
  const load=()=>API.get(`/api/compliance/work-hours?month=${month}`).then(setData);
  useEffect(load,[month]);
  const isDE=lang==='de';
  if(!data)return React.createElement('div',{className:'empty'},'加载中...');
  return React.createElement('div',{className:'fade'},
    React.createElement('div',{className:'flex',style:{justifyContent:'space-between',alignItems:'center',marginBottom:16}},
      React.createElement('h3',null,isDE?'Arbeitszeitkonformität':'工时合规检查',' - ',month),
      React.createElement('input',{type:'month',className:'input',value:month,onChange:e=>setMonth(e.target.value),style:{width:160}})),
    React.createElement('div',{className:'stats'},
      [{n:data.compliant?'✅':'⚠️',l:isDE?'Konformität':'合规状态',c:data.compliant?'var(--green)':'var(--red)'},
       {n:data.daily_count,l:isDE?'Tagesübersch. (>10h)':'日超时(>10h)',c:data.daily_count?'var(--red)':'var(--green)'},
       {n:data.weekly_count,l:isDE?'Wochenübersch. (>48h)':'周超时(>48h)',c:data.weekly_count?'var(--red)':'var(--green)'}
      ].map((s,i)=>React.createElement('div',{key:i,className:'stat'},
        React.createElement('div',{className:'num',style:{color:s.c}},s.n),
        React.createElement('div',{className:'label'},s.l)))),
    data.daily_violations.length>0&&React.createElement('div',{className:'card'},
      React.createElement('h4',{style:{color:'var(--red)',marginBottom:8}},isDE?'Tagesarbeitszeitverstoß (>10 Stunden/Tag)':'每日工时违规 (>10小时/天)'),
      React.createElement('div',{className:'table-wrap'},
        React.createElement('table',null,
          React.createElement('thead',null,React.createElement('tr',null,
            [isDE?'Mitarbeiter':'员工',isDE?'Datum':'日期',isDE?'Lager':'仓库',isDE?'Stunden':'工时'].map(h=>React.createElement('th',{key:h},h)))),
          React.createElement('tbody',null,data.daily_violations.map((r,i)=>React.createElement('tr',{key:i},
            React.createElement('td',null,r.employee_name),React.createElement('td',null,r.work_date),
            React.createElement('td',null,r.warehouse_code),React.createElement('td',{style:{color:'var(--red)',fontWeight:700}},r.hours+'h'))))))),
    data.weekly_violations.length>0&&React.createElement('div',{className:'card'},
      React.createElement('h4',{style:{color:'var(--red)',marginBottom:8}},isDE?'Wochenarbeitszeitverstoß (>48 Stunden/Woche)':'每周工时违规 (>48小时/周)'),
      React.createElement('div',{className:'table-wrap'},
        React.createElement('table',null,
          React.createElement('thead',null,React.createElement('tr',null,
            [isDE?'Mitarbeiter':'员工',isDE?'Woche':'周次',isDE?'Stunden':'总工时',isDE?'Tage':'工作天数'].map(h=>React.createElement('th',{key:h},h)))),
          React.createElement('tbody',null,data.weekly_violations.map((r,i)=>React.createElement('tr',{key:i},
            React.createElement('td',null,r.employee_name),React.createElement('td',null,'W'+r.week_num),
            React.createElement('td',{style:{color:'var(--red)',fontWeight:700}},r.total_hours?.toFixed(1)+'h'),
            React.createElement('td',null,r.work_days))))))),
    data.compliant&&React.createElement('div',{className:'card',style:{textAlign:'center',padding:32}},
      React.createElement('div',{style:{fontSize:48}},'✅'),
      React.createElement('div',{style:{fontSize:16,fontWeight:600,marginTop:8}},
        isDE?'Alle Arbeitszeiten sind konform':'所有工时记录符合德国劳动法规定')));
};

// ══════ Main App ══════
const MENU = [
  {group:'个人',items:[
    {key:'mypage',icon:'👤',label:'我的页面',roles:['worker','wh','mgr','admin']},
  ]},
  {group:'核心',items:[
    {key:'dashboard',icon:'📊',label:'仪表盘'},
    {key:'employees',icon:'👥',label:'花名册'},
    {key:'orgchart',icon:'🏢',label:'组织架构'},
    {key:'grades',icon:'🏅',label:'职级体系'},
    {key:'performance',icon:'📈',label:'绩效考核'},
  ]},
  {group:'业务',items:[
    {key:'quotation',icon:'💰',label:'报价管理'},
    {key:'timesheet',icon:'⏱️',label:'工时记录'},
    {key:'container',icon:'📦',label:'装卸柜'},
    {key:'schedule',icon:'📅',label:'排班'},
    {key:'dispatch',icon:'🚛',label:'派遣需求'},
    {key:'warehouse',icon:'🏗️',label:'仓库管理',roles:['admin','hr','mgr']},
    {key:'safety',icon:'🛡️',label:'安全管理'},
  ]},
  {group:'人事',items:[
    {key:'register',icon:'📝',label:'员工申报',roles:['admin','hr','mgr']},
    {key:'files',icon:'📁',label:'人员档案'},
    {key:'docs',icon:'📚',label:'企业文献'},
    {key:'leave',icon:'🏖️',label:'假期管理'},
    {key:'expense',icon:'💳',label:'报销审批'},
    {key:'suppliers',icon:'🏢',label:'供应商'},
  ]},
  {group:'财务&系统',items:[
    {key:'settlement',icon:'💶',label:'财务结算'},
    {key:'payroll',icon:'📋',label:'发薪预览',roles:['admin','fin','mgr']},
    {key:'compliance',icon:'⚖️',label:'合规检查',roles:['admin','hr','mgr','fin']},
    {key:'whsalary',icon:'🏭',label:'仓库薪资',roles:['admin','hr','mgr']},
    {key:'accounts',icon:'🔑',label:'账号管理',roles:['admin','hr','mgr']},
    {key:'clock',icon:'🕐',label:'打卡'},
    {key:'admin',icon:'⚙️',label:'权限管理',roles:['admin']},
  ]}
];

const App=()=>{
  const[user,setUser]=useState(()=>{
    try{return JSON.parse(localStorage.getItem('hr_user')||'null')}catch{return null}
  });
  const[page,setPage]=useState('dashboard');
  const[lang,setLang]=useState('zh');
  const[sideOpen,setSide]=useState(false);
  const t=T[lang];

  useEffect(()=>{if('serviceWorker' in navigator)navigator.serviceWorker.register('/sw.js').catch(()=>{})},[]);

  if(!user) return React.createElement(LoginPage,{onLogin:setUser,lang,setLang});

  const pages={
    dashboard:DashPage, employees:EmpPage, grades:GradePage, performance:PerfPage,
    quotation:QuotePage, files:FilePage, leave:LeavePage, expense:ExpPage,
    timesheet:TSPage, settlement:SettPage, clock:ClockPage,
    mypage:MyPage, accounts:AccountPage, whsalary:WHSalaryPage, payroll:PayrollPreviewPage,
    warehouse:WarehousePage, docs:DocsPage,
    suppliers:SuppliersPage, container:ContainerPage, schedule:SchedulePage,
    dispatch:DispatchPage, admin:AdminPage,
    orgchart:OrgChartPage, safety:SafetyPage, register:RegisterPage, compliance:CompliancePage,
  };
  const PageComp=pages[page];

  const canView=(item)=>{
    if(!item.roles)return true;
    return item.roles.includes(user.role);
  };

  return React.createElement('div',{className:'app'},
    sideOpen&&React.createElement('div',{className:'sidebar-mask show',onClick:()=>setSide(false)}),
    React.createElement('div',{className:`sidebar ${sideOpen?'open':''}`},
      React.createElement('div',{className:'logo'},'渊博579',React.createElement('small',null,'HR System V6')),
      MENU.map(g=>{
        const visibleItems=g.items.filter(canView);
        if(!visibleItems.length)return null;
        return React.createElement(React.Fragment,{key:g.group},
          React.createElement('div',{className:'nav-group'},g.group),
          visibleItems.map(i=>React.createElement('div',{key:i.key,className:`nav-item ${page===i.key?'active':''}`,
            onClick:()=>{setPage(i.key);setSide(false)}},i.icon,' ',t[i.key]||i.label)));
      }),
      React.createElement('div',{style:{padding:12,borderTop:'1px solid var(--border)',marginTop:'auto'}},
        React.createElement('div',{style:{display:'flex',gap:4,marginBottom:8}},
          LANGS.map(l=>React.createElement('span',{key:l.c,onClick:()=>setLang(l.c),
            style:{cursor:'pointer',padding:'2px 6px',borderRadius:4,fontSize:11,
              background:lang===l.c?'var(--pri)':'transparent',color:lang===l.c?'#fff':'var(--text3)'}},l.n))),
        React.createElement('button',{className:'btn btn-ghost btn-sm',style:{width:'100%'},
          onClick:()=>{API.setToken('');localStorage.removeItem('hr_user');setUser(null)}},t.logout))),
    React.createElement('div',{className:'main'},
      React.createElement('div',{className:'header'},
        React.createElement('div',{className:'menu-btn',onClick:()=>setSide(!sideOpen)},'☰'),
        React.createElement('div',{className:'title'},t[page]||page),
        React.createElement('div',{className:'user-info'},
          React.createElement('span',{className:'badge'},user.role||'admin'),
          React.createElement('span',null,user.display_name||'Admin'))),
      React.createElement('div',{className:'content'},
        PageComp?React.createElement(PageComp,{t,user,lang}):React.createElement('div',{className:'empty'},'模块开发中...'))),
    React.createElement('div',{id:'toast',className:'toast',style:{display:'none'}}));
};

ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
const fallback=document.getElementById('login-fallback');
if(fallback) fallback.style.display='none';
</script>
</body>
</html>
